<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width"/><title>LWDW!</title><meta name="description" content="数学没学好，动画没头脑——transform篇"/><meta property="og:title" content="数学没学好，动画没头脑——transform篇"/><meta property="og:description" content="关于transform相关值计算的代码在该库的CSSPlugin.js插件中，方法名为`getTransform`，这里截取要讨论的部分（只涉及二维变换部分）：......"/><meta name="next-head-count" content="6"/><link rel="apple-touch-icon" sizes="180x180" href="/favicon/apple-touch-icon.png"/><link rel="icon" type="image/png" sizes="32x32" href="/favicon/favicon-32x32.png"/><link rel="icon" type="image/png" sizes="16x16" href="/favicon/favicon-16x16.png"/><link rel="manifest" href="/favicon/site.webmanifest"/><link rel="mask-icon" href="/favicon/safari-pinned-tab.svg" color="#ffffff"/><meta name="color-scheme" content="dark light"/><meta name="msapplication-TileColor" content="#ffffff"/><meta name="theme-color" content="#000"/><meta property="og:type" content="website"/><meta property="og:image" content="https://s2.loli.net/2023/01/18/42YTZxzePtR7jy9.png"/><meta property="og:url" content="https://b-sirius.github.io"/><link rel="preload" href="/_next/static/css/aef510c8abf24c2c.css" as="style"/><link rel="stylesheet" href="/_next/static/css/aef510c8abf24c2c.css" data-n-g=""/><link rel="preload" href="/_next/static/css/b51a0fb142b75fa0.css" as="style"/><link rel="stylesheet" href="/_next/static/css/b51a0fb142b75fa0.css" data-n-p=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-c67a75d1b6f99dc8.js"></script><script src="/_next/static/chunks/webpack-165611dbf69200d4.js" defer=""></script><script src="/_next/static/chunks/framework-114634acb84f8baa.js" defer=""></script><script src="/_next/static/chunks/main-673a4fae4a27af6a.js" defer=""></script><script src="/_next/static/chunks/pages/_app-0da236044dc4e5fc.js" defer=""></script><script src="/_next/static/chunks/332-751efa0ececa7b8e.js" defer=""></script><script src="/_next/static/chunks/664-1b4479b4462ded63.js" defer=""></script><script src="/_next/static/chunks/pages/posts/%5Bid%5D-2b4aeb585f50200f.js" defer=""></script><script src="/_next/static/FyxqUbHN51XEFT6ZDcrPF/_buildManifest.js" defer=""></script><script src="/_next/static/FyxqUbHN51XEFT6ZDcrPF/_ssgManifest.js" defer=""></script></head><body><div id="__next"><div class="sc-9d615c10-0 gPcDhw"><div class="sc-868660b6-0 hptnUW"><div class="sc-bbc62a17-1 bGsVUC"><div class="sc-bbc62a17-0 dSoHmK"><a class="sc-bbc62a17-2 gGxkic" href="/">[<!-- -->Home<!-- -->]</a><a class="sc-bbc62a17-2 gGxkic" href="/posts">[<!-- -->Posts<!-- -->]</a><a class="sc-bbc62a17-3 bMRVsR" rel="noopener noreferrer" target="_blank" href="https://github.com/B-sirius">[<!-- -->Github<!-- -->]</a><a class="sc-bbc62a17-3 bMRVsR" rel="noopener noreferrer" target="_blank" href="https://b-sirius.github.io/rss.xml">[<!-- -->RSS<!-- -->]</a></div><div class="sc-f71203c5-0 cEuFcK"><h1 class="sc-f71203c5-1 BdBtZ">LWDW!</h1><p class="sc-f71203c5-2 gXENPI">Learn the work from doing the work🍺</p></div></div><div class="sc-87e76b53-0 sc-77cf2bd4-0 hkJmkj dxfnCq"><div><div class="sc-ba46d312-0 hOKWax"><div class="sc-ba46d312-2 ibvPNw">数学没学好，动画没头脑——transform篇</div><div class="sc-ba46d312-3 hcdRzS">Posted on <!-- -->2017-12-19</div></div></div></div><div class="sc-87e76b53-0 hkJmkj"><div><div class="sc-ba46d312-1 dmDrcr"><div class="sc-e9ca5221-0 czeavQ"><p>在俺的<a href="http://b-sirius.me/2017/04/19/%E5%8A%A8%E7%94%BBtransform%E7%AF%87/" target="_blank" rel="noreferrer">《当我们讨论动画时，我们在讨论什么——transform篇》</a>水文中，对于transform属性的matrix值，我曾写下了这样的话：“我们可以方便的从<code>rotate</code>值计算出<code>matrix</code>值，但是想要反过来（主要是获得rotate值，涉及到三角函数）却很不精确，暂时不考虑这种方法”。我之所以能如此大言不惭的得出这个结论，大概是因为 velocity.js 没有对 rotate 做足够的优化，我也就想着“连如此知名的动画库都没有做，大概是没有好的解决方法吧”，心安理得的将这个问题搁置一边了......直到最近发现强大的GreenSock动画库，早就解决了这个问题。于是就看了一下相关的源码——靠，原来有种叫反三角函数的东西就是为这量身打造的啊！初高中不在考点里老师根本没讲啊喂！（哇，自己没姿势还怪别人，关注了）</p>
<h2 id="源码分析">源码分析</h2>
<p>关于transform相关值计算的代码在该库的CSSPlugin.js插件中，方法名为<code>getTransform</code>，这里截取要讨论的部分（只涉及二维变换部分）：</p>
<pre class="language-javascript"><code class="language-Javascript"><span class="token keyword">var</span> k <span class="token operator">=</span> <span class="token punctuation">(</span>m<span class="token punctuation">.</span><span class="token property-access">length</span> <span class="token operator">&gt;=</span> <span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    a <span class="token operator">=</span> k <span class="token operator">?</span> m<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
    b <span class="token operator">=</span> m<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">||</span> <span class="token number">0</span><span class="token punctuation">,</span>
    c <span class="token operator">=</span> m<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">||</span> <span class="token number">0</span><span class="token punctuation">,</span>
    d <span class="token operator">=</span> k <span class="token operator">?</span> m<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">;</span>
tm<span class="token punctuation">.</span><span class="token property-access">x</span> <span class="token operator">=</span> m<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span> <span class="token operator">||</span> <span class="token number">0</span><span class="token punctuation">;</span>
tm<span class="token punctuation">.</span><span class="token property-access">y</span> <span class="token operator">=</span> m<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span> <span class="token operator">||</span> <span class="token number">0</span><span class="token punctuation">;</span>
scaleX <span class="token operator">=</span> <span class="token known-class-name class-name">Math</span><span class="token punctuation">.</span><span class="token method function property-access">sqrt</span><span class="token punctuation">(</span>a <span class="token operator">*</span> a <span class="token operator">+</span> b <span class="token operator">*</span> b<span class="token punctuation">)</span><span class="token punctuation">;</span>
scaleY <span class="token operator">=</span> <span class="token known-class-name class-name">Math</span><span class="token punctuation">.</span><span class="token method function property-access">sqrt</span><span class="token punctuation">(</span>d <span class="token operator">*</span> d <span class="token operator">+</span> c <span class="token operator">*</span> c<span class="token punctuation">)</span><span class="token punctuation">;</span>
rotation <span class="token operator">=</span> <span class="token punctuation">(</span>a <span class="token operator">||</span> b<span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token known-class-name class-name">Math</span><span class="token punctuation">.</span><span class="token method function property-access">atan2</span><span class="token punctuation">(</span>b<span class="token punctuation">,</span> a<span class="token punctuation">)</span> <span class="token operator">*</span> _RAD2DEG <span class="token operator">:</span> tm<span class="token punctuation">.</span><span class="token property-access">rotation</span> <span class="token operator">||</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token comment">//note: if scaleX is 0, we cannot accurately measure rotation. Same for skewX with a scaleY of 0. Therefore, we default to the previously recorded value (or zero if that doesn&#x27;t exist).</span>
skewX <span class="token operator">=</span> <span class="token punctuation">(</span>c <span class="token operator">||</span> d<span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token known-class-name class-name">Math</span><span class="token punctuation">.</span><span class="token method function property-access">atan2</span><span class="token punctuation">(</span>c<span class="token punctuation">,</span> d<span class="token punctuation">)</span> <span class="token operator">*</span> _RAD2DEG <span class="token operator">+</span> rotation <span class="token operator">:</span> tm<span class="token punctuation">.</span><span class="token property-access">skewX</span> <span class="token operator">||</span> <span class="token number">0</span><span class="token punctuation">;</span>
</code></pre>
<p>这段代码中的 m 就是matrix矩阵数组，在继续之前请仔细阅读张鑫旭的<a href="http://www.zhangxinxu.com/wordpress/2012/06/css3-transform-matrix-%E7%9F%A9%E9%98%B5/" target="_blank" rel="noreferrer">理解CSS3 transform中的Matrix(矩阵)</a>，这个m便是所谓的[a, b, c, d, e, f]，这里总结下各个transform属性对他们的影响：</p>
<ul>
<li>
<p>translate</p>
<p><code>translate3d(X, Y, 0)</code>，则 e = X, f = Y</p>
</li>
<li>
<p>scale</p>
<p><code>scale(S1, S2)</code>，则 a = S1, d = S2</p>
</li>
<li>
<p>rotate</p>
<p><code>rotate(θdeg)</code>，则 a = cosθ，b = sinθ，c = -sinθ，d = cosθ</p>
</li>
<li>
<p>skew</p>
<p><code>skew(α1, α2)</code>, b = tanα2，c = tanα1</p>
</li>
</ul>
<p>而多个属性混合，其实就是这些玩意儿相乘怼到一起</p>
<p>而如果一个点是(x, y)，应用矩阵变换，得到的点就是(ax+cy+e, bx+dy+f)，带入上面的值，便是：</p>
<p><code>(S1*cosθ*x - tanα1*sinθ*y + X, tanα2*sinθ*x + S2*cosθ*y + Y)</code></p>
<p>虽然上面那串很恶心，但是…...其实这个点我们其实不需要直接使用，因为我们知道上面四个属性是不相互影响的，因此在我们从矩阵中寻找某属性值的过程中，可以将另外三者设为方便计算的值。</p>
<p>比如我心心念念的rotate值，求法在代码中已经写出，其实就是<code>Math.atan2(b, a) * _RAD2DEG</code> ，<strong>atan2是一个利用反正切函数的方法</strong>，而<strong>反正切函数是利用已知直角<a href="https://zh.wikipedia.org/wiki/%E4%B8%89%E8%A7%92%E5%BD%A2" target="_blank" rel="noreferrer">三角形</a>的对边和邻边这两条直角边的<a href="https://zh.wikipedia.org/wiki/%E6%AF%94%E4%BE%8B" target="_blank" rel="noreferrer">比值</a>求出其夹角大小的函数</strong>，而**<code>Math.atan2(b, a)</code>返回的便是点(a, b)相对于原点的角度（-pi 到 pi），是一个逆时针角度，以弧度为单位**，那为什么在这里传递的参数是<code>b, a</code>呢？因为旋转对于所有点的效果是一致的，所以我取x正轴上一点(x, 0)，其他的变换假设为初始值（因为他们不影响），则其旋转θ度后，坐标为<code>(cosθ*x，sinθ*x)</code>，这个θ是旋转的角度，是我们想要求的值，而我把这个坐标的y, x值放入<code>Math.atan2</code>，得到的是该点到与原点间的弧度值，由于我的初始点是在x正轴上，所以该弧度值就是我们要求的角度θ（当然要进行一个角度和弧度之间的转换）！也就是说，只要将<code>sinθ，cosθ</code>扔进<code>Math.atan2</code>，就能得到θ——等等，上文不就有了，<code>a = cosθ，b = sinθ</code>！所以这里的角度就是<code>Math.atan2(b, a) * _RAD2DEG</code>。当然在有其他属性的情况下<code>a = cosθ，b = sinθ</code>并不成立，但既然这些属性不影响θ，<code>Math.atan2(b, a) * _RAD2DEG</code>仍然是我们需要的角度。</p>
<p>其他的值其实也是可以类似推导，其实说这么多不如心中画个图来的靠谱，总觉得上面的强行推理怪怪的，经过了一万次心理博弈【摊】</p>
<hr/>
<p>回过头一看，这玩意儿其实都是初高中内容，作为一个大三学生纠结了半天，真是太鸡儿丢人了。说起来GreenSock也是见了很多酷炫的网站在用，不过这玩意儿的logo长个像个威猛先生一样，官网也是有一点企业的拟物风，完全没有一个框架的感觉。结果仔细一看，简直太靠谱了，不愧是Flash时代就久负盛名的团队，有种“Flash死了？那我今天就要教你做H5动画”的感觉。看看同样的效果，人家丝滑60帧，我只有20-30帧，还是要多学习一个啊。</p></div></div></div></div><div class="sc-3304c032-0 fiBoCN"><div></div></div></div></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"id":"use-matrix-in-transform","title":"数学没学好，动画没头脑——transform篇","date":"2017-12-19","mdxSource":{"compiledSource":"/*@jsxRuntime automatic @jsxImportSource react*/\nconst {Fragment: _Fragment, jsx: _jsx, jsxs: _jsxs} = arguments[0];\nconst {useMDXComponents: _provideComponents} = arguments[0];\nfunction _createMdxContent(props) {\n  const _components = Object.assign({\n    p: \"p\",\n    a: \"a\",\n    code: \"code\",\n    h2: \"h2\",\n    pre: \"pre\",\n    span: \"span\",\n    ul: \"ul\",\n    li: \"li\",\n    strong: \"strong\",\n    hr: \"hr\"\n  }, _provideComponents(), props.components);\n  return _jsxs(_Fragment, {\n    children: [_jsxs(_components.p, {\n      children: [\"在俺的\", _jsx(_components.a, {\n        href: \"http://b-sirius.me/2017/04/19/%E5%8A%A8%E7%94%BBtransform%E7%AF%87/\",\n        children: \"《当我们讨论动画时，我们在讨论什么——transform篇》\"\n      }), \"水文中，对于transform属性的matrix值，我曾写下了这样的话：“我们可以方便的从\", _jsx(_components.code, {\n        children: \"rotate\"\n      }), \"值计算出\", _jsx(_components.code, {\n        children: \"matrix\"\n      }), \"值，但是想要反过来（主要是获得rotate值，涉及到三角函数）却很不精确，暂时不考虑这种方法”。我之所以能如此大言不惭的得出这个结论，大概是因为 velocity.js 没有对 rotate 做足够的优化，我也就想着“连如此知名的动画库都没有做，大概是没有好的解决方法吧”，心安理得的将这个问题搁置一边了......直到最近发现强大的GreenSock动画库，早就解决了这个问题。于是就看了一下相关的源码——靠，原来有种叫反三角函数的东西就是为这量身打造的啊！初高中不在考点里老师根本没讲啊喂！（哇，自己没姿势还怪别人，关注了）\"]\n    }), \"\\n\", _jsx(_components.h2, {\n      id: \"源码分析\",\n      children: \"源码分析\"\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"关于transform相关值计算的代码在该库的CSSPlugin.js插件中，方法名为\", _jsx(_components.code, {\n        children: \"getTransform\"\n      }), \"，这里截取要讨论的部分（只涉及二维变换部分）：\"]\n    }), \"\\n\", _jsx(_components.pre, {\n      className: \"language-javascript\",\n      children: _jsxs(_components.code, {\n        className: \"language-Javascript\",\n        children: [_jsx(_components.span, {\n          className: \"token keyword\",\n          children: \"var\"\n        }), \" k \", _jsx(_components.span, {\n          className: \"token operator\",\n          children: \"=\"\n        }), \" \", _jsx(_components.span, {\n          className: \"token punctuation\",\n          children: \"(\"\n        }), \"m\", _jsx(_components.span, {\n          className: \"token punctuation\",\n          children: \".\"\n        }), _jsx(_components.span, {\n          className: \"token property-access\",\n          children: \"length\"\n        }), \" \", _jsx(_components.span, {\n          className: \"token operator\",\n          children: \"\u003e=\"\n        }), \" \", _jsx(_components.span, {\n          className: \"token number\",\n          children: \"6\"\n        }), _jsx(_components.span, {\n          className: \"token punctuation\",\n          children: \")\"\n        }), _jsx(_components.span, {\n          className: \"token punctuation\",\n          children: \",\"\n        }), \"\\n    a \", _jsx(_components.span, {\n          className: \"token operator\",\n          children: \"=\"\n        }), \" k \", _jsx(_components.span, {\n          className: \"token operator\",\n          children: \"?\"\n        }), \" m\", _jsx(_components.span, {\n          className: \"token punctuation\",\n          children: \"[\"\n        }), _jsx(_components.span, {\n          className: \"token number\",\n          children: \"0\"\n        }), _jsx(_components.span, {\n          className: \"token punctuation\",\n          children: \"]\"\n        }), \" \", _jsx(_components.span, {\n          className: \"token operator\",\n          children: \":\"\n        }), \" \", _jsx(_components.span, {\n          className: \"token number\",\n          children: \"1\"\n        }), _jsx(_components.span, {\n          className: \"token punctuation\",\n          children: \",\"\n        }), \"\\n    b \", _jsx(_components.span, {\n          className: \"token operator\",\n          children: \"=\"\n        }), \" m\", _jsx(_components.span, {\n          className: \"token punctuation\",\n          children: \"[\"\n        }), _jsx(_components.span, {\n          className: \"token number\",\n          children: \"1\"\n        }), _jsx(_components.span, {\n          className: \"token punctuation\",\n          children: \"]\"\n        }), \" \", _jsx(_components.span, {\n          className: \"token operator\",\n          children: \"||\"\n        }), \" \", _jsx(_components.span, {\n          className: \"token number\",\n          children: \"0\"\n        }), _jsx(_components.span, {\n          className: \"token punctuation\",\n          children: \",\"\n        }), \"\\n    c \", _jsx(_components.span, {\n          className: \"token operator\",\n          children: \"=\"\n        }), \" m\", _jsx(_components.span, {\n          className: \"token punctuation\",\n          children: \"[\"\n        }), _jsx(_components.span, {\n          className: \"token number\",\n          children: \"2\"\n        }), _jsx(_components.span, {\n          className: \"token punctuation\",\n          children: \"]\"\n        }), \" \", _jsx(_components.span, {\n          className: \"token operator\",\n          children: \"||\"\n        }), \" \", _jsx(_components.span, {\n          className: \"token number\",\n          children: \"0\"\n        }), _jsx(_components.span, {\n          className: \"token punctuation\",\n          children: \",\"\n        }), \"\\n    d \", _jsx(_components.span, {\n          className: \"token operator\",\n          children: \"=\"\n        }), \" k \", _jsx(_components.span, {\n          className: \"token operator\",\n          children: \"?\"\n        }), \" m\", _jsx(_components.span, {\n          className: \"token punctuation\",\n          children: \"[\"\n        }), _jsx(_components.span, {\n          className: \"token number\",\n          children: \"3\"\n        }), _jsx(_components.span, {\n          className: \"token punctuation\",\n          children: \"]\"\n        }), \" \", _jsx(_components.span, {\n          className: \"token operator\",\n          children: \":\"\n        }), \" \", _jsx(_components.span, {\n          className: \"token number\",\n          children: \"1\"\n        }), _jsx(_components.span, {\n          className: \"token punctuation\",\n          children: \";\"\n        }), \"\\ntm\", _jsx(_components.span, {\n          className: \"token punctuation\",\n          children: \".\"\n        }), _jsx(_components.span, {\n          className: \"token property-access\",\n          children: \"x\"\n        }), \" \", _jsx(_components.span, {\n          className: \"token operator\",\n          children: \"=\"\n        }), \" m\", _jsx(_components.span, {\n          className: \"token punctuation\",\n          children: \"[\"\n        }), _jsx(_components.span, {\n          className: \"token number\",\n          children: \"4\"\n        }), _jsx(_components.span, {\n          className: \"token punctuation\",\n          children: \"]\"\n        }), \" \", _jsx(_components.span, {\n          className: \"token operator\",\n          children: \"||\"\n        }), \" \", _jsx(_components.span, {\n          className: \"token number\",\n          children: \"0\"\n        }), _jsx(_components.span, {\n          className: \"token punctuation\",\n          children: \";\"\n        }), \"\\ntm\", _jsx(_components.span, {\n          className: \"token punctuation\",\n          children: \".\"\n        }), _jsx(_components.span, {\n          className: \"token property-access\",\n          children: \"y\"\n        }), \" \", _jsx(_components.span, {\n          className: \"token operator\",\n          children: \"=\"\n        }), \" m\", _jsx(_components.span, {\n          className: \"token punctuation\",\n          children: \"[\"\n        }), _jsx(_components.span, {\n          className: \"token number\",\n          children: \"5\"\n        }), _jsx(_components.span, {\n          className: \"token punctuation\",\n          children: \"]\"\n        }), \" \", _jsx(_components.span, {\n          className: \"token operator\",\n          children: \"||\"\n        }), \" \", _jsx(_components.span, {\n          className: \"token number\",\n          children: \"0\"\n        }), _jsx(_components.span, {\n          className: \"token punctuation\",\n          children: \";\"\n        }), \"\\nscaleX \", _jsx(_components.span, {\n          className: \"token operator\",\n          children: \"=\"\n        }), \" \", _jsx(_components.span, {\n          className: \"token known-class-name class-name\",\n          children: \"Math\"\n        }), _jsx(_components.span, {\n          className: \"token punctuation\",\n          children: \".\"\n        }), _jsx(_components.span, {\n          className: \"token method function property-access\",\n          children: \"sqrt\"\n        }), _jsx(_components.span, {\n          className: \"token punctuation\",\n          children: \"(\"\n        }), \"a \", _jsx(_components.span, {\n          className: \"token operator\",\n          children: \"*\"\n        }), \" a \", _jsx(_components.span, {\n          className: \"token operator\",\n          children: \"+\"\n        }), \" b \", _jsx(_components.span, {\n          className: \"token operator\",\n          children: \"*\"\n        }), \" b\", _jsx(_components.span, {\n          className: \"token punctuation\",\n          children: \")\"\n        }), _jsx(_components.span, {\n          className: \"token punctuation\",\n          children: \";\"\n        }), \"\\nscaleY \", _jsx(_components.span, {\n          className: \"token operator\",\n          children: \"=\"\n        }), \" \", _jsx(_components.span, {\n          className: \"token known-class-name class-name\",\n          children: \"Math\"\n        }), _jsx(_components.span, {\n          className: \"token punctuation\",\n          children: \".\"\n        }), _jsx(_components.span, {\n          className: \"token method function property-access\",\n          children: \"sqrt\"\n        }), _jsx(_components.span, {\n          className: \"token punctuation\",\n          children: \"(\"\n        }), \"d \", _jsx(_components.span, {\n          className: \"token operator\",\n          children: \"*\"\n        }), \" d \", _jsx(_components.span, {\n          className: \"token operator\",\n          children: \"+\"\n        }), \" c \", _jsx(_components.span, {\n          className: \"token operator\",\n          children: \"*\"\n        }), \" c\", _jsx(_components.span, {\n          className: \"token punctuation\",\n          children: \")\"\n        }), _jsx(_components.span, {\n          className: \"token punctuation\",\n          children: \";\"\n        }), \"\\nrotation \", _jsx(_components.span, {\n          className: \"token operator\",\n          children: \"=\"\n        }), \" \", _jsx(_components.span, {\n          className: \"token punctuation\",\n          children: \"(\"\n        }), \"a \", _jsx(_components.span, {\n          className: \"token operator\",\n          children: \"||\"\n        }), \" b\", _jsx(_components.span, {\n          className: \"token punctuation\",\n          children: \")\"\n        }), \" \", _jsx(_components.span, {\n          className: \"token operator\",\n          children: \"?\"\n        }), \" \", _jsx(_components.span, {\n          className: \"token known-class-name class-name\",\n          children: \"Math\"\n        }), _jsx(_components.span, {\n          className: \"token punctuation\",\n          children: \".\"\n        }), _jsx(_components.span, {\n          className: \"token method function property-access\",\n          children: \"atan2\"\n        }), _jsx(_components.span, {\n          className: \"token punctuation\",\n          children: \"(\"\n        }), \"b\", _jsx(_components.span, {\n          className: \"token punctuation\",\n          children: \",\"\n        }), \" a\", _jsx(_components.span, {\n          className: \"token punctuation\",\n          children: \")\"\n        }), \" \", _jsx(_components.span, {\n          className: \"token operator\",\n          children: \"*\"\n        }), \" _RAD2DEG \", _jsx(_components.span, {\n          className: \"token operator\",\n          children: \":\"\n        }), \" tm\", _jsx(_components.span, {\n          className: \"token punctuation\",\n          children: \".\"\n        }), _jsx(_components.span, {\n          className: \"token property-access\",\n          children: \"rotation\"\n        }), \" \", _jsx(_components.span, {\n          className: \"token operator\",\n          children: \"||\"\n        }), \" \", _jsx(_components.span, {\n          className: \"token number\",\n          children: \"0\"\n        }), _jsx(_components.span, {\n          className: \"token punctuation\",\n          children: \";\"\n        }), \" \", _jsx(_components.span, {\n          className: \"token comment\",\n          children: \"//note: if scaleX is 0, we cannot accurately measure rotation. Same for skewX with a scaleY of 0. Therefore, we default to the previously recorded value (or zero if that doesn't exist).\"\n        }), \"\\nskewX \", _jsx(_components.span, {\n          className: \"token operator\",\n          children: \"=\"\n        }), \" \", _jsx(_components.span, {\n          className: \"token punctuation\",\n          children: \"(\"\n        }), \"c \", _jsx(_components.span, {\n          className: \"token operator\",\n          children: \"||\"\n        }), \" d\", _jsx(_components.span, {\n          className: \"token punctuation\",\n          children: \")\"\n        }), \" \", _jsx(_components.span, {\n          className: \"token operator\",\n          children: \"?\"\n        }), \" \", _jsx(_components.span, {\n          className: \"token known-class-name class-name\",\n          children: \"Math\"\n        }), _jsx(_components.span, {\n          className: \"token punctuation\",\n          children: \".\"\n        }), _jsx(_components.span, {\n          className: \"token method function property-access\",\n          children: \"atan2\"\n        }), _jsx(_components.span, {\n          className: \"token punctuation\",\n          children: \"(\"\n        }), \"c\", _jsx(_components.span, {\n          className: \"token punctuation\",\n          children: \",\"\n        }), \" d\", _jsx(_components.span, {\n          className: \"token punctuation\",\n          children: \")\"\n        }), \" \", _jsx(_components.span, {\n          className: \"token operator\",\n          children: \"*\"\n        }), \" _RAD2DEG \", _jsx(_components.span, {\n          className: \"token operator\",\n          children: \"+\"\n        }), \" rotation \", _jsx(_components.span, {\n          className: \"token operator\",\n          children: \":\"\n        }), \" tm\", _jsx(_components.span, {\n          className: \"token punctuation\",\n          children: \".\"\n        }), _jsx(_components.span, {\n          className: \"token property-access\",\n          children: \"skewX\"\n        }), \" \", _jsx(_components.span, {\n          className: \"token operator\",\n          children: \"||\"\n        }), \" \", _jsx(_components.span, {\n          className: \"token number\",\n          children: \"0\"\n        }), _jsx(_components.span, {\n          className: \"token punctuation\",\n          children: \";\"\n        }), \"\\n\"]\n      })\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"这段代码中的 m 就是matrix矩阵数组，在继续之前请仔细阅读张鑫旭的\", _jsx(_components.a, {\n        href: \"http://www.zhangxinxu.com/wordpress/2012/06/css3-transform-matrix-%E7%9F%A9%E9%98%B5/\",\n        children: \"理解CSS3 transform中的Matrix(矩阵)\"\n      }), \"，这个m便是所谓的[a, b, c, d, e, f]，这里总结下各个transform属性对他们的影响：\"]\n    }), \"\\n\", _jsxs(_components.ul, {\n      children: [\"\\n\", _jsxs(_components.li, {\n        children: [\"\\n\", _jsx(_components.p, {\n          children: \"translate\"\n        }), \"\\n\", _jsxs(_components.p, {\n          children: [_jsx(_components.code, {\n            children: \"translate3d(X, Y, 0)\"\n          }), \"，则 e = X, f = Y\"]\n        }), \"\\n\"]\n      }), \"\\n\", _jsxs(_components.li, {\n        children: [\"\\n\", _jsx(_components.p, {\n          children: \"scale\"\n        }), \"\\n\", _jsxs(_components.p, {\n          children: [_jsx(_components.code, {\n            children: \"scale(S1, S2)\"\n          }), \"，则 a = S1, d = S2\"]\n        }), \"\\n\"]\n      }), \"\\n\", _jsxs(_components.li, {\n        children: [\"\\n\", _jsx(_components.p, {\n          children: \"rotate\"\n        }), \"\\n\", _jsxs(_components.p, {\n          children: [_jsx(_components.code, {\n            children: \"rotate(θdeg)\"\n          }), \"，则 a = cosθ，b = sinθ，c = -sinθ，d = cosθ\"]\n        }), \"\\n\"]\n      }), \"\\n\", _jsxs(_components.li, {\n        children: [\"\\n\", _jsx(_components.p, {\n          children: \"skew\"\n        }), \"\\n\", _jsxs(_components.p, {\n          children: [_jsx(_components.code, {\n            children: \"skew(α1, α2)\"\n          }), \", b = tanα2，c = tanα1\"]\n        }), \"\\n\"]\n      }), \"\\n\"]\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"而多个属性混合，其实就是这些玩意儿相乘怼到一起\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"而如果一个点是(x, y)，应用矩阵变换，得到的点就是(ax+cy+e, bx+dy+f)，带入上面的值，便是：\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: _jsx(_components.code, {\n        children: \"(S1*cosθ*x - tanα1*sinθ*y + X, tanα2*sinθ*x + S2*cosθ*y + Y)\"\n      })\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"虽然上面那串很恶心，但是…...其实这个点我们其实不需要直接使用，因为我们知道上面四个属性是不相互影响的，因此在我们从矩阵中寻找某属性值的过程中，可以将另外三者设为方便计算的值。\"\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"比如我心心念念的rotate值，求法在代码中已经写出，其实就是\", _jsx(_components.code, {\n        children: \"Math.atan2(b, a) * _RAD2DEG\"\n      }), \" ，\", _jsx(_components.strong, {\n        children: \"atan2是一个利用反正切函数的方法\"\n      }), \"，而\", _jsxs(_components.strong, {\n        children: [\"反正切函数是利用已知直角\", _jsx(_components.a, {\n          href: \"https://zh.wikipedia.org/wiki/%E4%B8%89%E8%A7%92%E5%BD%A2\",\n          children: \"三角形\"\n        }), \"的对边和邻边这两条直角边的\", _jsx(_components.a, {\n          href: \"https://zh.wikipedia.org/wiki/%E6%AF%94%E4%BE%8B\",\n          children: \"比值\"\n        }), \"求出其夹角大小的函数\"]\n      }), \"，而**\", _jsx(_components.code, {\n        children: \"Math.atan2(b, a)\"\n      }), \"返回的便是点(a, b)相对于原点的角度（-pi 到 pi），是一个逆时针角度，以弧度为单位**，那为什么在这里传递的参数是\", _jsx(_components.code, {\n        children: \"b, a\"\n      }), \"呢？因为旋转对于所有点的效果是一致的，所以我取x正轴上一点(x, 0)，其他的变换假设为初始值（因为他们不影响），则其旋转θ度后，坐标为\", _jsx(_components.code, {\n        children: \"(cosθ*x，sinθ*x)\"\n      }), \"，这个θ是旋转的角度，是我们想要求的值，而我把这个坐标的y, x值放入\", _jsx(_components.code, {\n        children: \"Math.atan2\"\n      }), \"，得到的是该点到与原点间的弧度值，由于我的初始点是在x正轴上，所以该弧度值就是我们要求的角度θ（当然要进行一个角度和弧度之间的转换）！也就是说，只要将\", _jsx(_components.code, {\n        children: \"sinθ，cosθ\"\n      }), \"扔进\", _jsx(_components.code, {\n        children: \"Math.atan2\"\n      }), \"，就能得到θ——等等，上文不就有了，\", _jsx(_components.code, {\n        children: \"a = cosθ，b = sinθ\"\n      }), \"！所以这里的角度就是\", _jsx(_components.code, {\n        children: \"Math.atan2(b, a) * _RAD2DEG\"\n      }), \"。当然在有其他属性的情况下\", _jsx(_components.code, {\n        children: \"a = cosθ，b = sinθ\"\n      }), \"并不成立，但既然这些属性不影响θ，\", _jsx(_components.code, {\n        children: \"Math.atan2(b, a) * _RAD2DEG\"\n      }), \"仍然是我们需要的角度。\"]\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"其他的值其实也是可以类似推导，其实说这么多不如心中画个图来的靠谱，总觉得上面的强行推理怪怪的，经过了一万次心理博弈【摊】\"\n    }), \"\\n\", _jsx(_components.hr, {}), \"\\n\", _jsx(_components.p, {\n      children: \"回过头一看，这玩意儿其实都是初高中内容，作为一个大三学生纠结了半天，真是太鸡儿丢人了。说起来GreenSock也是见了很多酷炫的网站在用，不过这玩意儿的logo长个像个威猛先生一样，官网也是有一点企业的拟物风，完全没有一个框架的感觉。结果仔细一看，简直太靠谱了，不愧是Flash时代就久负盛名的团队，有种“Flash死了？那我今天就要教你做H5动画”的感觉。看看同样的效果，人家丝滑60帧，我只有20-30帧，还是要多学习一个啊。\"\n    })]\n  });\n}\nfunction MDXContent(props = {}) {\n  const {wrapper: MDXLayout} = Object.assign({}, _provideComponents(), props.components);\n  return MDXLayout ? _jsx(MDXLayout, Object.assign({}, props, {\n    children: _jsx(_createMdxContent, props)\n  })) : _createMdxContent(props);\n}\nreturn {\n  default: MDXContent\n};\n","frontmatter":{},"scope":{}},"description":"关于transform相关值计算的代码在该库的CSSPlugin.js插件中，方法名为`getTransform`，这里截取要讨论的部分（只涉及二维变换部分）：......","usedCustomComponentNames":[]},"__N_SSG":true},"page":"/posts/[id]","query":{"id":"use-matrix-in-transform"},"buildId":"FyxqUbHN51XEFT6ZDcrPF","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>