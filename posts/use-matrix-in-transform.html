<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width"/><title>LWDW!</title><meta name="description" content="数学没学好，动画没头脑——transform篇"/><meta property="og:title" content="数学没学好，动画没头脑——transform篇"/><meta property="og:description" content="关于transform相关值计算的代码在该库的CSSPlugin.js插件中，方法名为`getTransform`，这里截取要讨论的部分（只涉及二维变换部分）：......"/><meta name="next-head-count" content="6"/><link rel="apple-touch-icon" sizes="180x180" href="/favicon/apple-touch-icon.png"/><link rel="icon" type="image/png" sizes="32x32" href="/favicon/favicon-32x32.png"/><link rel="icon" type="image/png" sizes="16x16" href="/favicon/favicon-16x16.png"/><link rel="manifest" href="/favicon/site.webmanifest"/><link rel="mask-icon" href="/favicon/safari-pinned-tab.svg" color="#ffffff"/><meta name="msapplication-TileColor" content="#ffffff"/><meta name="theme-color" content="#000"/><meta property="og:type" content="website"/><meta property="og:image" content="https://s2.loli.net/2023/01/18/42YTZxzePtR7jy9.png"/><meta property="og:url" content="https://b-sirius.github.io"/><link rel="preload" href="/_next/static/css/aef510c8abf24c2c.css" as="style"/><link rel="stylesheet" href="/_next/static/css/aef510c8abf24c2c.css" data-n-g=""/><link rel="preload" href="/_next/static/css/b51a0fb142b75fa0.css" as="style"/><link rel="stylesheet" href="/_next/static/css/b51a0fb142b75fa0.css" data-n-p=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-c67a75d1b6f99dc8.js"></script><script src="/_next/static/chunks/webpack-f164db4954bac6ec.js" defer=""></script><script src="/_next/static/chunks/framework-114634acb84f8baa.js" defer=""></script><script src="/_next/static/chunks/main-673a4fae4a27af6a.js" defer=""></script><script src="/_next/static/chunks/pages/_app-0da236044dc4e5fc.js" defer=""></script><script src="/_next/static/chunks/664-1b4479b4462ded63.js" defer=""></script><script src="/_next/static/chunks/332-e879213584d084bf.js" defer=""></script><script src="/_next/static/chunks/pages/posts/%5Bid%5D-1001914fc6870d3d.js" defer=""></script><script src="/_next/static/u9-Sh7cpFEfudU57A_VSr/_buildManifest.js" defer=""></script><script src="/_next/static/u9-Sh7cpFEfudU57A_VSr/_ssgManifest.js" defer=""></script></head><body><div id="__next"><div class="sc-b711fa3b-0 dxGMRG"><div class="sc-7fa12c98-0 iqAzDm"><div class="sc-357ac6e1-1 blSmbb"><div class="sc-357ac6e1-0 fqUBXX"><a class="sc-357ac6e1-2 gfNIvm" href="/">[<!-- -->Home<!-- -->]</a><a class="sc-357ac6e1-2 gfNIvm" href="/posts">[<!-- -->Posts<!-- -->]</a><a class="sc-357ac6e1-3 eNeEmH" rel="noopener noreferrer" target="_blank" href="https://github.com/B-sirius">[<!-- -->Github<!-- -->]</a><a class="sc-357ac6e1-3 eNeEmH" rel="noopener noreferrer" target="_blank" href="https://b-sirius.github.io/rss.xml">[<!-- -->RSS<!-- -->]</a></div><div class="sc-f5ce872-0 drvesR"><h1 class="sc-f5ce872-1 jPBPjm">LWDW!</h1><p class="sc-f5ce872-2 djaGsH">Learn the work from doing the work🍺</p></div></div><div class="sc-920e94b6-0 sc-20291786-0 cMfBpD eCERES"><div><div class="sc-32c5999b-0 iFBmZi"><div class="sc-32c5999b-2 fHkOeB">数学没学好，动画没头脑——transform篇</div><div class="sc-32c5999b-3 deKveP">Posted on <!-- -->2017-12-19</div></div></div></div><div class="sc-920e94b6-0 cMfBpD"><div><div class="sc-32c5999b-1 fNXLto"><div class="sc-29ea8e37-0 bjoUyc"><div><html><head></head><body><p>在俺的<a href="http://b-sirius.me/2017/04/19/%E5%8A%A8%E7%94%BBtransform%E7%AF%87/" target="_blank" rel="nofollow">《当我们讨论动画时，我们在讨论什么——transform篇》</a>水文中，对于transform属性的matrix值，我曾写下了这样的话：“我们可以方便的从<code>rotate</code>值计算出<code>matrix</code>值，但是想要反过来（主要是获得rotate值，涉及到三角函数）却很不精确，暂时不考虑这种方法”。我之所以能如此大言不惭的得出这个结论，大概是因为 velocity.js 没有对 rotate 做足够的优化，我也就想着“连如此知名的动画库都没有做，大概是没有好的解决方法吧”，心安理得的将这个问题搁置一边了......直到最近发现强大的GreenSock动画库，早就解决了这个问题。于是就看了一下相关的源码——靠，原来有种叫反三角函数的东西就是为这量身打造的啊！初高中不在考点里老师根本没讲啊喂！（哇，自己没姿势还怪别人，关注了）</p>
<h2 id="源码分析">源码分析</h2>
<p>关于transform相关值计算的代码在该库的CSSPlugin.js插件中，方法名为<code>getTransform</code>，这里截取要讨论的部分（只涉及二维变换部分）：</p>
<pre class="language-javascript"><code class="language-Javascript"><span class="token keyword">var</span> k <span class="token operator">=</span> <span class="token punctuation">(</span>m<span class="token punctuation">.</span><span class="token property-access">length</span> <span class="token operator">>=</span> <span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    a <span class="token operator">=</span> k <span class="token operator">?</span> m<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
    b <span class="token operator">=</span> m<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">||</span> <span class="token number">0</span><span class="token punctuation">,</span>
    c <span class="token operator">=</span> m<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">||</span> <span class="token number">0</span><span class="token punctuation">,</span>
    d <span class="token operator">=</span> k <span class="token operator">?</span> m<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">;</span>
tm<span class="token punctuation">.</span><span class="token property-access">x</span> <span class="token operator">=</span> m<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span> <span class="token operator">||</span> <span class="token number">0</span><span class="token punctuation">;</span>
tm<span class="token punctuation">.</span><span class="token property-access">y</span> <span class="token operator">=</span> m<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span> <span class="token operator">||</span> <span class="token number">0</span><span class="token punctuation">;</span>
scaleX <span class="token operator">=</span> <span class="token known-class-name class-name">Math</span><span class="token punctuation">.</span><span class="token method function property-access">sqrt</span><span class="token punctuation">(</span>a <span class="token operator">*</span> a <span class="token operator">+</span> b <span class="token operator">*</span> b<span class="token punctuation">)</span><span class="token punctuation">;</span>
scaleY <span class="token operator">=</span> <span class="token known-class-name class-name">Math</span><span class="token punctuation">.</span><span class="token method function property-access">sqrt</span><span class="token punctuation">(</span>d <span class="token operator">*</span> d <span class="token operator">+</span> c <span class="token operator">*</span> c<span class="token punctuation">)</span><span class="token punctuation">;</span>
rotation <span class="token operator">=</span> <span class="token punctuation">(</span>a <span class="token operator">||</span> b<span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token known-class-name class-name">Math</span><span class="token punctuation">.</span><span class="token method function property-access">atan2</span><span class="token punctuation">(</span>b<span class="token punctuation">,</span> a<span class="token punctuation">)</span> <span class="token operator">*</span> _RAD2DEG <span class="token operator">:</span> tm<span class="token punctuation">.</span><span class="token property-access">rotation</span> <span class="token operator">||</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token comment">//note: if scaleX is 0, we cannot accurately measure rotation. Same for skewX with a scaleY of 0. Therefore, we default to the previously recorded value (or zero if that doesn't exist).</span>
skewX <span class="token operator">=</span> <span class="token punctuation">(</span>c <span class="token operator">||</span> d<span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token known-class-name class-name">Math</span><span class="token punctuation">.</span><span class="token method function property-access">atan2</span><span class="token punctuation">(</span>c<span class="token punctuation">,</span> d<span class="token punctuation">)</span> <span class="token operator">*</span> _RAD2DEG <span class="token operator">+</span> rotation <span class="token operator">:</span> tm<span class="token punctuation">.</span><span class="token property-access">skewX</span> <span class="token operator">||</span> <span class="token number">0</span><span class="token punctuation">;</span>
</code></pre>
<p>这段代码中的 m 就是matrix矩阵数组，在继续之前请仔细阅读张鑫旭的<a href="http://www.zhangxinxu.com/wordpress/2012/06/css3-transform-matrix-%E7%9F%A9%E9%98%B5/" target="_blank" rel="nofollow">理解CSS3 transform中的Matrix(矩阵)</a>，这个m便是所谓的[a, b, c, d, e, f]，这里总结下各个transform属性对他们的影响：</p>
<ul>
<li>
<p>translate</p>
<p><code>translate3d(X, Y, 0)</code>，则 e = X, f = Y</p>
</li>
<li>
<p>scale</p>
<p><code>scale(S1, S2)</code>，则 a = S1, d = S2</p>
</li>
<li>
<p>rotate</p>
<p><code>rotate(θdeg)</code>，则 a = cosθ，b = sinθ，c = -sinθ，d = cosθ</p>
</li>
<li>
<p>skew</p>
<p><code>skew(α1, α2)</code>, b = tanα2，c = tanα1</p>
</li>
</ul>
<p>而多个属性混合，其实就是这些玩意儿相乘怼到一起</p>
<p>而如果一个点是(x, y)，应用矩阵变换，得到的点就是(ax+cy+e, bx+dy+f)，带入上面的值，便是：</p>
<p><code>(S1*cosθ*x - tanα1*sinθ*y + X, tanα2*sinθ*x + S2*cosθ*y + Y)</code></p>
<p>虽然上面那串很恶心，但是…...其实这个点我们其实不需要直接使用，因为我们知道上面四个属性是不相互影响的，因此在我们从矩阵中寻找某属性值的过程中，可以将另外三者设为方便计算的值。</p>
<p>比如我心心念念的rotate值，求法在代码中已经写出，其实就是<code>Math.atan2(b, a) * _RAD2DEG</code> ，<strong>atan2是一个利用反正切函数的方法</strong>，而<strong>反正切函数是利用已知直角<a href="https://zh.wikipedia.org/wiki/%E4%B8%89%E8%A7%92%E5%BD%A2" target="_blank" rel="nofollow">三角形</a>的对边和邻边这两条直角边的<a href="https://zh.wikipedia.org/wiki/%E6%AF%94%E4%BE%8B" target="_blank" rel="nofollow">比值</a>求出其夹角大小的函数</strong>，而**<code>Math.atan2(b, a)</code>返回的便是点(a, b)相对于原点的角度（-pi 到 pi），是一个逆时针角度，以弧度为单位**，那为什么在这里传递的参数是<code>b, a</code>呢？因为旋转对于所有点的效果是一致的，所以我取x正轴上一点(x, 0)，其他的变换假设为初始值（因为他们不影响），则其旋转θ度后，坐标为<code>(cosθ*x，sinθ*x)</code>，这个θ是旋转的角度，是我们想要求的值，而我把这个坐标的y, x值放入<code>Math.atan2</code>，得到的是该点到与原点间的弧度值，由于我的初始点是在x正轴上，所以该弧度值就是我们要求的角度θ（当然要进行一个角度和弧度之间的转换）！也就是说，只要将<code>sinθ，cosθ</code>扔进<code>Math.atan2</code>，就能得到θ——等等，上文不就有了，<code>a = cosθ，b = sinθ</code>！所以这里的角度就是<code>Math.atan2(b, a) * _RAD2DEG</code>。当然在有其他属性的情况下<code>a = cosθ，b = sinθ</code>并不成立，但既然这些属性不影响θ，<code>Math.atan2(b, a) * _RAD2DEG</code>仍然是我们需要的角度。</p>
<p>其他的值其实也是可以类似推导，其实说这么多不如心中画个图来的靠谱，总觉得上面的强行推理怪怪的，经过了一万次心理博弈【摊】</p>
<hr>
<p>回过头一看，这玩意儿其实都是初高中内容，作为一个大三学生纠结了半天，真是太鸡儿丢人了。说起来GreenSock也是见了很多酷炫的网站在用，不过这玩意儿的logo长个像个威猛先生一样，官网也是有一点企业的拟物风，完全没有一个框架的感觉。结果仔细一看，简直太靠谱了，不愧是Flash时代就久负盛名的团队，有种“Flash死了？那我今天就要教你做H5动画”的感觉。看看同样的效果，人家丝滑60帧，我只有20-30帧，还是要多学习一个啊。</p>
</body></html></div></div></div></div></div><div class="sc-bbd5e802-0 cbkQsN"><div></div></div></div></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"id":"use-matrix-in-transform","title":"数学没学好，动画没头脑——transform篇","date":"2017-12-19","htmlText":"\u003chtml\u003e\u003chead\u003e\u003c/head\u003e\u003cbody\u003e\u003cp\u003e在俺的\u003ca href=\"http://b-sirius.me/2017/04/19/%E5%8A%A8%E7%94%BBtransform%E7%AF%87/\" target=\"_blank\" rel=\"nofollow\"\u003e《当我们讨论动画时，我们在讨论什么——transform篇》\u003c/a\u003e水文中，对于transform属性的matrix值，我曾写下了这样的话：“我们可以方便的从\u003ccode\u003erotate\u003c/code\u003e值计算出\u003ccode\u003ematrix\u003c/code\u003e值，但是想要反过来（主要是获得rotate值，涉及到三角函数）却很不精确，暂时不考虑这种方法”。我之所以能如此大言不惭的得出这个结论，大概是因为 velocity.js 没有对 rotate 做足够的优化，我也就想着“连如此知名的动画库都没有做，大概是没有好的解决方法吧”，心安理得的将这个问题搁置一边了......直到最近发现强大的GreenSock动画库，早就解决了这个问题。于是就看了一下相关的源码——靠，原来有种叫反三角函数的东西就是为这量身打造的啊！初高中不在考点里老师根本没讲啊喂！（哇，自己没姿势还怪别人，关注了）\u003c/p\u003e\n\u003ch2 id=\"源码分析\"\u003e源码分析\u003c/h2\u003e\n\u003cp\u003e关于transform相关值计算的代码在该库的CSSPlugin.js插件中，方法名为\u003ccode\u003egetTransform\u003c/code\u003e，这里截取要讨论的部分（只涉及二维变换部分）：\u003c/p\u003e\n\u003cpre class=\"language-javascript\"\u003e\u003ccode class=\"language-Javascript\"\u003e\u003cspan class=\"token keyword\"\u003evar\u003c/span\u003e k \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003em\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token property-access\"\u003elength\u003c/span\u003e \u003cspan class=\"token operator\"\u003e\u003e=\u003c/span\u003e \u003cspan class=\"token number\"\u003e6\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n    a \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e k \u003cspan class=\"token operator\"\u003e?\u003c/span\u003e m\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token number\"\u003e0\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e \u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token number\"\u003e1\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n    b \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e m\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token number\"\u003e1\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e \u003cspan class=\"token operator\"\u003e||\u003c/span\u003e \u003cspan class=\"token number\"\u003e0\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n    c \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e m\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token number\"\u003e2\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e \u003cspan class=\"token operator\"\u003e||\u003c/span\u003e \u003cspan class=\"token number\"\u003e0\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n    d \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e k \u003cspan class=\"token operator\"\u003e?\u003c/span\u003e m\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token number\"\u003e3\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e \u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token number\"\u003e1\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\ntm\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token property-access\"\u003ex\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e m\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token number\"\u003e4\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e \u003cspan class=\"token operator\"\u003e||\u003c/span\u003e \u003cspan class=\"token number\"\u003e0\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\ntm\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token property-access\"\u003ey\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e m\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token number\"\u003e5\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e \u003cspan class=\"token operator\"\u003e||\u003c/span\u003e \u003cspan class=\"token number\"\u003e0\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\nscaleX \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token known-class-name class-name\"\u003eMath\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token method function property-access\"\u003esqrt\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003ea \u003cspan class=\"token operator\"\u003e*\u003c/span\u003e a \u003cspan class=\"token operator\"\u003e+\u003c/span\u003e b \u003cspan class=\"token operator\"\u003e*\u003c/span\u003e b\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\nscaleY \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token known-class-name class-name\"\u003eMath\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token method function property-access\"\u003esqrt\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003ed \u003cspan class=\"token operator\"\u003e*\u003c/span\u003e d \u003cspan class=\"token operator\"\u003e+\u003c/span\u003e c \u003cspan class=\"token operator\"\u003e*\u003c/span\u003e c\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\nrotation \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003ea \u003cspan class=\"token operator\"\u003e||\u003c/span\u003e b\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token operator\"\u003e?\u003c/span\u003e \u003cspan class=\"token known-class-name class-name\"\u003eMath\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token method function property-access\"\u003eatan2\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eb\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e a\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token operator\"\u003e*\u003c/span\u003e _RAD2DEG \u003cspan class=\"token operator\"\u003e:\u003c/span\u003e tm\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token property-access\"\u003erotation\u003c/span\u003e \u003cspan class=\"token operator\"\u003e||\u003c/span\u003e \u003cspan class=\"token number\"\u003e0\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e \u003cspan class=\"token comment\"\u003e//note: if scaleX is 0, we cannot accurately measure rotation. Same for skewX with a scaleY of 0. Therefore, we default to the previously recorded value (or zero if that doesn't exist).\u003c/span\u003e\nskewX \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003ec \u003cspan class=\"token operator\"\u003e||\u003c/span\u003e d\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token operator\"\u003e?\u003c/span\u003e \u003cspan class=\"token known-class-name class-name\"\u003eMath\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token method function property-access\"\u003eatan2\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003ec\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e d\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token operator\"\u003e*\u003c/span\u003e _RAD2DEG \u003cspan class=\"token operator\"\u003e+\u003c/span\u003e rotation \u003cspan class=\"token operator\"\u003e:\u003c/span\u003e tm\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token property-access\"\u003eskewX\u003c/span\u003e \u003cspan class=\"token operator\"\u003e||\u003c/span\u003e \u003cspan class=\"token number\"\u003e0\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e这段代码中的 m 就是matrix矩阵数组，在继续之前请仔细阅读张鑫旭的\u003ca href=\"http://www.zhangxinxu.com/wordpress/2012/06/css3-transform-matrix-%E7%9F%A9%E9%98%B5/\" target=\"_blank\" rel=\"nofollow\"\u003e理解CSS3 transform中的Matrix(矩阵)\u003c/a\u003e，这个m便是所谓的[a, b, c, d, e, f]，这里总结下各个transform属性对他们的影响：\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003etranslate\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003etranslate3d(X, Y, 0)\u003c/code\u003e，则 e = X, f = Y\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003escale\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003escale(S1, S2)\u003c/code\u003e，则 a = S1, d = S2\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003erotate\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003erotate(θdeg)\u003c/code\u003e，则 a = cosθ，b = sinθ，c = -sinθ，d = cosθ\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eskew\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003eskew(α1, α2)\u003c/code\u003e, b = tanα2，c = tanα1\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e而多个属性混合，其实就是这些玩意儿相乘怼到一起\u003c/p\u003e\n\u003cp\u003e而如果一个点是(x, y)，应用矩阵变换，得到的点就是(ax+cy+e, bx+dy+f)，带入上面的值，便是：\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003e(S1*cosθ*x - tanα1*sinθ*y + X, tanα2*sinθ*x + S2*cosθ*y + Y)\u003c/code\u003e\u003c/p\u003e\n\u003cp\u003e虽然上面那串很恶心，但是…...其实这个点我们其实不需要直接使用，因为我们知道上面四个属性是不相互影响的，因此在我们从矩阵中寻找某属性值的过程中，可以将另外三者设为方便计算的值。\u003c/p\u003e\n\u003cp\u003e比如我心心念念的rotate值，求法在代码中已经写出，其实就是\u003ccode\u003eMath.atan2(b, a) * _RAD2DEG\u003c/code\u003e ，\u003cstrong\u003eatan2是一个利用反正切函数的方法\u003c/strong\u003e，而\u003cstrong\u003e反正切函数是利用已知直角\u003ca href=\"https://zh.wikipedia.org/wiki/%E4%B8%89%E8%A7%92%E5%BD%A2\" target=\"_blank\" rel=\"nofollow\"\u003e三角形\u003c/a\u003e的对边和邻边这两条直角边的\u003ca href=\"https://zh.wikipedia.org/wiki/%E6%AF%94%E4%BE%8B\" target=\"_blank\" rel=\"nofollow\"\u003e比值\u003c/a\u003e求出其夹角大小的函数\u003c/strong\u003e，而**\u003ccode\u003eMath.atan2(b, a)\u003c/code\u003e返回的便是点(a, b)相对于原点的角度（-pi 到 pi），是一个逆时针角度，以弧度为单位**，那为什么在这里传递的参数是\u003ccode\u003eb, a\u003c/code\u003e呢？因为旋转对于所有点的效果是一致的，所以我取x正轴上一点(x, 0)，其他的变换假设为初始值（因为他们不影响），则其旋转θ度后，坐标为\u003ccode\u003e(cosθ*x，sinθ*x)\u003c/code\u003e，这个θ是旋转的角度，是我们想要求的值，而我把这个坐标的y, x值放入\u003ccode\u003eMath.atan2\u003c/code\u003e，得到的是该点到与原点间的弧度值，由于我的初始点是在x正轴上，所以该弧度值就是我们要求的角度θ（当然要进行一个角度和弧度之间的转换）！也就是说，只要将\u003ccode\u003esinθ，cosθ\u003c/code\u003e扔进\u003ccode\u003eMath.atan2\u003c/code\u003e，就能得到θ——等等，上文不就有了，\u003ccode\u003ea = cosθ，b = sinθ\u003c/code\u003e！所以这里的角度就是\u003ccode\u003eMath.atan2(b, a) * _RAD2DEG\u003c/code\u003e。当然在有其他属性的情况下\u003ccode\u003ea = cosθ，b = sinθ\u003c/code\u003e并不成立，但既然这些属性不影响θ，\u003ccode\u003eMath.atan2(b, a) * _RAD2DEG\u003c/code\u003e仍然是我们需要的角度。\u003c/p\u003e\n\u003cp\u003e其他的值其实也是可以类似推导，其实说这么多不如心中画个图来的靠谱，总觉得上面的强行推理怪怪的，经过了一万次心理博弈【摊】\u003c/p\u003e\n\u003chr\u003e\n\u003cp\u003e回过头一看，这玩意儿其实都是初高中内容，作为一个大三学生纠结了半天，真是太鸡儿丢人了。说起来GreenSock也是见了很多酷炫的网站在用，不过这玩意儿的logo长个像个威猛先生一样，官网也是有一点企业的拟物风，完全没有一个框架的感觉。结果仔细一看，简直太靠谱了，不愧是Flash时代就久负盛名的团队，有种“Flash死了？那我今天就要教你做H5动画”的感觉。看看同样的效果，人家丝滑60帧，我只有20-30帧，还是要多学习一个啊。\u003c/p\u003e\n\u003c/body\u003e\u003c/html\u003e","description":"关于transform相关值计算的代码在该库的CSSPlugin.js插件中，方法名为`getTransform`，这里截取要讨论的部分（只涉及二维变换部分）：......"},"__N_SSG":true},"page":"/posts/[id]","query":{"id":"use-matrix-in-transform"},"buildId":"u9-Sh7cpFEfudU57A_VSr","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>