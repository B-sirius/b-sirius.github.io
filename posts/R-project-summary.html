<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width"/><title>LWDW!</title><meta name="description" content="R项目小结"/><meta property="og:title" content="R项目小结"/><meta property="og:description" content="最近结束的一个项目有很多值得学习的地方，挑一些不敏感的在此记录。其中的每一点其实都有深入挖掘的空间，日后想必会再次遇到。......"/><meta name="next-head-count" content="6"/><link rel="apple-touch-icon" sizes="180x180" href="/favicon/apple-touch-icon.png"/><link rel="icon" type="image/png" sizes="32x32" href="/favicon/favicon-32x32.png"/><link rel="icon" type="image/png" sizes="16x16" href="/favicon/favicon-16x16.png"/><link rel="manifest" href="/favicon/site.webmanifest"/><link rel="mask-icon" href="/favicon/safari-pinned-tab.svg" color="#ffffff"/><meta name="msapplication-TileColor" content="#ffffff"/><meta name="theme-color" content="#000"/><meta property="og:type" content="website"/><meta property="og:image" content="https://s2.loli.net/2023/01/18/42YTZxzePtR7jy9.png"/><meta property="og:url" content="https://b-sirius.github.io"/><link rel="preload" href="/_next/static/css/aef510c8abf24c2c.css" as="style"/><link rel="stylesheet" href="/_next/static/css/aef510c8abf24c2c.css" data-n-g=""/><link rel="preload" href="/_next/static/css/b51a0fb142b75fa0.css" as="style"/><link rel="stylesheet" href="/_next/static/css/b51a0fb142b75fa0.css" data-n-p=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-c67a75d1b6f99dc8.js"></script><script src="/_next/static/chunks/webpack-f164db4954bac6ec.js" defer=""></script><script src="/_next/static/chunks/framework-114634acb84f8baa.js" defer=""></script><script src="/_next/static/chunks/main-673a4fae4a27af6a.js" defer=""></script><script src="/_next/static/chunks/pages/_app-0da236044dc4e5fc.js" defer=""></script><script src="/_next/static/chunks/664-1b4479b4462ded63.js" defer=""></script><script src="/_next/static/chunks/332-e879213584d084bf.js" defer=""></script><script src="/_next/static/chunks/pages/posts/%5Bid%5D-f9bad91587257bf5.js" defer=""></script><script src="/_next/static/L_CyqIx4aqZcAL1u9DngY/_buildManifest.js" defer=""></script><script src="/_next/static/L_CyqIx4aqZcAL1u9DngY/_ssgManifest.js" defer=""></script></head><body><div id="__next"><div class="sc-590e23a2-0 iUjvom"><div class="sc-7fa12c98-0 iqAzDm"><div class="sc-357ac6e1-1 blSmbb"><div class="sc-357ac6e1-0 fqUBXX"><a class="sc-357ac6e1-2 gfNIvm" href="/">[<!-- -->Home<!-- -->]</a><a class="sc-357ac6e1-2 gfNIvm" href="/posts">[<!-- -->Posts<!-- -->]</a><a class="sc-357ac6e1-3 eNeEmH" rel="noopener noreferrer" target="_blank" href="https://github.com/B-sirius">[<!-- -->Github<!-- -->]</a><a class="sc-357ac6e1-3 eNeEmH" rel="noopener noreferrer" target="_blank" href="https://b-sirius.github.io/rss.xml">[<!-- -->RSS<!-- -->]</a></div><div class="sc-f5ce872-0 drvesR"><h1 class="sc-f5ce872-1 jPBPjm">LWDW!</h1><p class="sc-f5ce872-2 djaGsH">Learn the work from doing the work🍺</p></div></div><div class="sc-920e94b6-0 sc-659069c1-0 cMfBpD jHWfVM"><div><div class="sc-32c5999b-0 iFBmZi"><div class="sc-32c5999b-2 fHkOeB">R项目小结</div><div class="sc-32c5999b-3 deKveP">Posted on <!-- -->2023-01-09</div></div></div></div><div class="sc-920e94b6-0 cMfBpD"><div><div class="sc-32c5999b-1 fNXLto"><div class="sc-a2d97488-0 dmbacr"><div><html><head></head><body><p>最近结束的一个项目有很多值得学习的地方，挑一些不敏感的在此记录。其中的每一点其实都有深入挖掘的空间，日后想必会再次遇到。</p>
<hr>
<h2 id="文档设计">文档设计</h2>
<p>有哪些文档可以整理归总？有的文档适合单独总结，有的适合放在Readme中，但总之，以下是一些可以考虑的点。</p>
<h3 id="系统设计文档">系统设计文档</h3>
<p>这里的设计指的是系统的架构，尤其要关注<strong>系统之间是如何连接的</strong>。</p>
<p>而以下内容不应该被包含在其中：</p>
<ul>
<li>服务的具体细节。</li>
<li>组件的设计模式。</li>
</ul>
<h3 id="组件文档">组件文档</h3>
<p>整理所有的组件/服务，可以有以下关注点：</p>
<ul>
<li>介绍</li>
<li>服务类型（比如SSR /Static）</li>
<li>路由前缀</li>
<li>生产环境域名</li>
<li>预发环境域名</li>
<li>测试环境域名（规则）</li>
<li>仓库地址</li>
<li>流水线地址</li>
<li>发布分支</li>
<li>涉及技术栈</li>
</ul>
<h3 id="开发者faq">开发者FAQ</h3>
<p>目的是收集开发者关心的常见问题，比如项目如何本地启动，必要权限如何申请等。</p>
<h3 id="开发者验证指南">开发者验证指南</h3>
<p>目的是保证开发者提交的组件可以在生产环境中运行，而不是完全依赖QA。常见的手段有测试用例，code review等，且很可能与CI/CD流程有关。个人觉得开发者很容易对一些小改动有迷之自信，结果却提交无法在测试环境运行的代码甚至搞崩线上。该步骤非常重要又容易被忽视。</p>
<h2 id="aws服务">AWS服务</h2>
<p>aws服务太常见了，稍微记录一下我本次接触的，不至于一些名词都没有概念。</p>
<h3 id="ecs">ECS</h3>
<p>ECS is Amazon Elastic <strong>Container Service</strong>.</p>
<ul>
<li>Container Orchestration Service (容器编排工具）</li>
<li>Manages the whole container lifecycle.
<ul>
<li>start</li>
<li>re-schedule</li>
<li>load balance</li>
</ul>
</li>
<li>ECS Cluster（ECS集群）是Control Plane，管理所有运行着容器的虚拟机器。</li>
</ul>
<p><img src="https://s2.loli.net/2023/01/09/u8ytTRfvmx7gk4n.jpg" alt="How does ECS work"></p>
<ul>
<li>而这些虚拟机是什么？是EC2 Instance，你还是需要管理这些Instance的，比如在增加container的时候，需要确保Instance的资源足够。</li>
<li>但如果我们想在AWS上hosting infrastructure。可以用AWS Fargate。那就不需要手动管理Instance，他会根据你想要运行的container来自动分配资源。节省呀！</li>
</ul>
<h3 id="eks">EKS</h3>
<p>EKS is Elastic <strong>Kubernetes</strong> Service.</p>
<p>Kubernetes 是ECS的竞品，非常Popular，所以EKS就是为了在AWS使用Kubernetes推出的。</p>
<p>EKS的工作方式和ECS差不多。</p>
<h3 id="ecr">ECR</h3>
<p>ECR is Elastic <strong>Container Registry</strong>, a private docker registry.</p>
<p><img src="https://s2.loli.net/2023/01/09/Lw6m7geKZ9A4YSW.png" alt="whole story, Jenkins involved here!"></p>
<h3 id="elb">ELB</h3>
<p>ELB is Elastic load balancing service.</p>
<p><img src="https://s2.loli.net/2023/01/09/EaFjZvJ731LDGRA.png" alt="负载均衡服务"></p>
<p>使用这样一个 load balancer有很多好处</p>
<ul>
<li>将流量分配给了很多下级实例</li>
<li>只暴露出一个入口（DNS）</li>
<li>无缝处理下级应用的failures</li>
<li>对实例进行健康检查</li>
<li>提供https</li>
<li>强制使用cookies，所以用户可以访问到同一个instance</li>
<li>…</li>
</ul>
<h3 id="aws-lambda">AWS lambda</h3>
<p>这是一个Serverless服务，基本上可以理解为它提供了根据事件自动触发Function的能力。</p>
<p>其中事件可以指的是S3的内容变化，API的请求，或其他各种各样的AWS服务事件。</p>
<p>这里涉及到一个概念，Serverless，值得说一说。</p>
<p>我个人的理解是这样的：</p>
<p>首先Serverless并不是说没有Server，而是Server对用户不可见，which means：</p>
<ul>
<li>不需要手动管理server。</li>
<li>会根据使用自动扩容。</li>
<li>只有当被使用的时候，才会产生费用（而不是为Server本身付费）。</li>
</ul>
<p><img src="https://s2.loli.net/2023/01/09/B2oTW3lrEuznZGK.png" alt=""></p>
<h2 id="环境变量">环境变量</h2>
<h3 id="环境变量-in-nextjs">环境变量 in Next.js</h3>
<p>Before <code>const HOST_NAME = 'www.sample.com'</code>.</p>
<p>After <code>const HOST_NAME = 'process.env.NEXT_PUBLIC_HOST_NAME'</code>.</p>
<p>这里涉及到Next.js的一个特性：<a href="https://nextjs.org/docs/basic-features/environment-variables#exposing-environment-variables-to-the-browser" target="_blank" rel="nofollow">expose env vars to the browser</a>。</p>
<ul>
<li>During the <strong>build stage</strong>, next.js will find these env vars start with <strong>NEXT_PUBLIC_</strong> and replace them with literal.</li>
<li>build stage很关键，在CI/CD流程中，可能有build、release等多个环节，在哪里传入环境变量很关键。</li>
</ul>
<p><strong>Trick: 如果在一些情形下，我们需要把用于node端的环境变量暴露给浏览器，可以怎么做？</strong></p>
<ul>
<li>Read these env vars inside <code>getServerSideProps</code> and return them as props. <a href="https://nextjs.org/docs/basic-features/data-fetching/get-server-side-props#when-does-getserversideprops-run" target="_blank" rel="nofollow">More to read about it</a>.</li>
</ul>
<pre class="language-javascript"><code class="language-javascript">  <span class="token keyword module">export</span> <span class="token keyword">const</span> <span class="token function-variable function">getServerSideProps</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token comment">// we can read server side env vars here.</span>
    <span class="token keyword control-flow">return</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">serverConstants</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token constant">TEST_HOST_NAME</span><span class="token operator">:</span> process<span class="token punctuation">.</span><span class="token property-access">env</span><span class="token punctuation">.</span><span class="token constant">TEST_HOST_NAME</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  
  <span class="token comment">// client side.</span>
  <span class="token keyword module">export</span> <span class="token keyword">const</span> <span class="token function-variable function"><span class="token maybe-class-name">Page</span></span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> serverConstants <span class="token punctuation">}</span> <span class="token operator">=</span> props<span class="token punctuation">;</span>
    <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
      <span class="token operator">&#x3C;</span>p<span class="token operator">></span><span class="token constant">TEST_HOST_NAME</span><span class="token operator">:</span> <span class="token punctuation">{</span>serverConstants<span class="token punctuation">.</span><span class="token constant">TEST_HOST_NAME</span><span class="token punctuation">}</span><span class="token operator">&#x3C;</span><span class="token operator">/</span>p<span class="token operator">></span>
    <span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
</code></pre>
<h3 id="本地环境变量">本地环境变量</h3>
<p>关于在本地开发中使用环境变量，next.js 已经有了很好的支持，查看 <a href="https://nextjs.org/docs/basic-features/environment-variables#loading-environment-variables" target="_blank" rel="nofollow">这里</a>。</p>
<p>在实际场景下，可以创建一个.env.local.examlpe文件。</p>
<p>开发者可以拷贝该文件并将其作为自己的.env.local文件。</p>
<p><strong>.env.local 不应该被提交到repo中！</strong></p>
<h3 id="环境变量-in-jest">环境变量 in Jest</h3>
<p>方法是有很多的，按需采用，这里记录两种。</p>
<h3 id="在jest的setup文件中设置环境变量">在jest的setup文件中设置环境变量</h3>
<p><a href="https://jestjs.io/docs/configuration#setupfilesafterenv-array" target="_blank" rel="nofollow">文档在此</a>。简单来说，在这里设置的环境变量会作用于每个测试用例文件。</p>
<p>适合用于设置默认环境变量，但无法满足需要测试不同的环境变量的场景。</p>
<h3 id="在测试用例文件中设置环境变量">在测试用例文件中设置环境变量</h3>
<p>当然我们可以在测试用例文件中设置环境变量。</p>
<p>只是要记住，在每个测试用例前，一定要使用 <a href="https://jestjs.io/docs/jest-object#jestresetmodules" target="_blank" rel="nofollow"><strong>restModules</strong></a> ，且<strong>动态引入</strong>涉及环境变量的模块。</p>
<pre class="language-javascript"><code class="language-javascript"><span class="token function">describe</span><span class="token punctuation">(</span><span class="token string">'environmental variables'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token constant">OLD_ENV</span> <span class="token operator">=</span> process<span class="token punctuation">.</span><span class="token property-access">env</span><span class="token punctuation">;</span>

  <span class="token function">beforeEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    jest<span class="token punctuation">.</span><span class="token method function property-access">resetModules</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// Most important - it clears the cache</span>
    process<span class="token punctuation">.</span><span class="token property-access">env</span> <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token spread operator">...</span><span class="token constant">OLD_ENV</span> <span class="token punctuation">}</span><span class="token punctuation">;</span> <span class="token comment">// Make a copy</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token function">afterAll</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    process<span class="token punctuation">.</span><span class="token property-access">env</span> <span class="token operator">=</span> <span class="token constant">OLD_ENV</span><span class="token punctuation">;</span> <span class="token comment">// Restore old environment</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'will receive process.env variables'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token comment">// Set the variables</span>
    process<span class="token punctuation">.</span><span class="token property-access">env</span><span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">=</span> <span class="token string">'dev'</span><span class="token punctuation">;</span>
    process<span class="token punctuation">.</span><span class="token property-access">env</span><span class="token punctuation">.</span><span class="token constant">PROXY_PREFIX</span> <span class="token operator">=</span> <span class="token string">'/new-prefix/'</span><span class="token punctuation">;</span>
    process<span class="token punctuation">.</span><span class="token property-access">env</span><span class="token punctuation">.</span><span class="token constant">API_URL</span> <span class="token operator">=</span> <span class="token string">'https://new-api.com/'</span><span class="token punctuation">;</span>
    process<span class="token punctuation">.</span><span class="token property-access">env</span><span class="token punctuation">.</span><span class="token constant">APP_PORT</span> <span class="token operator">=</span> <span class="token string">'7080'</span><span class="token punctuation">;</span>
    process<span class="token punctuation">.</span><span class="token property-access">env</span><span class="token punctuation">.</span><span class="token constant">USE_PROXY</span> <span class="token operator">=</span> <span class="token string">'false'</span><span class="token punctuation">;</span>

    <span class="token keyword">const</span> testedModule <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'../../config/env'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword module">default</span> <span class="token comment">// dynamic import</span>

    <span class="token comment">// ... actual testing</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<h2 id="其他">其他</h2>
<h3 id="本地一切安好线上发布缺少依赖可能是">本地一切安好，线上发布缺少依赖，可能是？</h3>
<p>规则：如果<code>NODE_ENV</code>被设置成<code>production</code>，yarn不会安装<code>devDependencies</code>中的依赖，具体可看<a href="https://classic.yarnpkg.com/en/docs/cli/install#toc-yarn-install-production-true-false" target="_blank" rel="nofollow">这里</a>。</p>
<p>所以这种cmd是合理的：<code>yarn install &#x26;&#x26; yarn test &#x26;&#x26; NODE_ENV=production yarn export</code>。</p>
<p>相对的，如果<code>NODE_ENV</code>被设置的太早，很可能会导致<code>yarn test</code>缺少依赖。</p>
<h3 id="如何更新包组件服务">如何更新包/组件/服务</h3>
<p>除了更新逻辑，一般还有哪些步骤？</p>
<ol>
<li>更新测试用例，保证本地测试用例通过。</li>
<li>本地成功运行服务。</li>
<li>开一个draft PR.
<ol>
<li>将其部署到测试环境。</li>
<li>在测试环境成功运行。</li>
</ol>
</li>
<li>更新版本。（视具体情形）</li>
<li>找人review。</li>
<li>有了approvals，可以merge。</li>
<li>其余的就是QA、部署流程等。</li>
</ol>
<h3 id="jwt">JWT</h3>
<p>JWT（JSON web token）是一种常见的在客户端与服务端间传递信息的方式。</p>
<ol>
<li>除非知道签名，用户是无法伪造数据的。</li>
<li>而header和payload本身是并没有被加密的。</li>
</ol>
<p>所以在实际应用场景中，任何人都可以查看请求的数据，但不知道签名的普通用户没办法自己构造、篡改请求。</p>
<p><a href="https://en.wikipedia.org/wiki/JSON_Web_Token" target="_blank" rel="nofollow">进一步了解JWT</a>。</p>
<h3 id="yarn2">Yarn2</h3>
<p>Yarn2 = <strong>yarn berry</strong>（更加准确）。和 yarn 1.x 比起来算是大改。</p>
<p>如果使用PnP特性，yarn会生成<code>.pnp.cjs</code>以代替<code>node_modules</code>。</p>
<p><code>.pnp.cjs</code>只是一些maps，包括如何在文件系统中找到packages。</p>
<p>而packages本身，是被zipped压缩过的，所以文件的数量远远少于<code>node_modules</code>。</p>
<p>尽管package被压缩过，我们仍然可以借助<code>fs</code>的能力读取文件。</p>
<p><strong>更多yarn2，欢迎阅读：</strong></p>
<ul>
<li><a href="https://blog.logrocket.com/javascript-package-managers-compared/" target="_blank" rel="nofollow">JavaScript package managers compared: npm, Yarn, or pnpm?</a></li>
<li><a href="https://www.yarnpkg.cn/features/pnp" target="_blank" rel="nofollow">Plug'n'Play</a></li>
</ul>
<h3 id="线上监控服务异常排查">线上监控服务异常排查</h3>
<p>如果怀疑有异常的线上流量，如何排查：</p>
<ol>
<li>调整时间区间，来观察流量是否是一瞬间涌入的。</li>
<li>比较服务端和客户端的流量，观察流量是否是直接打到服务端的。</li>
<li>比较流量峰值日志是否有共同点：Client IP, Country, Region, City…</li>
</ol>
</body></html></div></div></div></div></div><div class="sc-bbd5e802-0 cbkQsN"><div></div></div></div></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"id":"R-project-summary","title":"R项目小结","date":"2023-01-09","htmlText":"\u003chtml\u003e\u003chead\u003e\u003c/head\u003e\u003cbody\u003e\u003cp\u003e最近结束的一个项目有很多值得学习的地方，挑一些不敏感的在此记录。其中的每一点其实都有深入挖掘的空间，日后想必会再次遇到。\u003c/p\u003e\n\u003chr\u003e\n\u003ch2 id=\"文档设计\"\u003e文档设计\u003c/h2\u003e\n\u003cp\u003e有哪些文档可以整理归总？有的文档适合单独总结，有的适合放在Readme中，但总之，以下是一些可以考虑的点。\u003c/p\u003e\n\u003ch3 id=\"系统设计文档\"\u003e系统设计文档\u003c/h3\u003e\n\u003cp\u003e这里的设计指的是系统的架构，尤其要关注\u003cstrong\u003e系统之间是如何连接的\u003c/strong\u003e。\u003c/p\u003e\n\u003cp\u003e而以下内容不应该被包含在其中：\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e服务的具体细节。\u003c/li\u003e\n\u003cli\u003e组件的设计模式。\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch3 id=\"组件文档\"\u003e组件文档\u003c/h3\u003e\n\u003cp\u003e整理所有的组件/服务，可以有以下关注点：\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e介绍\u003c/li\u003e\n\u003cli\u003e服务类型（比如SSR /Static）\u003c/li\u003e\n\u003cli\u003e路由前缀\u003c/li\u003e\n\u003cli\u003e生产环境域名\u003c/li\u003e\n\u003cli\u003e预发环境域名\u003c/li\u003e\n\u003cli\u003e测试环境域名（规则）\u003c/li\u003e\n\u003cli\u003e仓库地址\u003c/li\u003e\n\u003cli\u003e流水线地址\u003c/li\u003e\n\u003cli\u003e发布分支\u003c/li\u003e\n\u003cli\u003e涉及技术栈\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch3 id=\"开发者faq\"\u003e开发者FAQ\u003c/h3\u003e\n\u003cp\u003e目的是收集开发者关心的常见问题，比如项目如何本地启动，必要权限如何申请等。\u003c/p\u003e\n\u003ch3 id=\"开发者验证指南\"\u003e开发者验证指南\u003c/h3\u003e\n\u003cp\u003e目的是保证开发者提交的组件可以在生产环境中运行，而不是完全依赖QA。常见的手段有测试用例，code review等，且很可能与CI/CD流程有关。个人觉得开发者很容易对一些小改动有迷之自信，结果却提交无法在测试环境运行的代码甚至搞崩线上。该步骤非常重要又容易被忽视。\u003c/p\u003e\n\u003ch2 id=\"aws服务\"\u003eAWS服务\u003c/h2\u003e\n\u003cp\u003eaws服务太常见了，稍微记录一下我本次接触的，不至于一些名词都没有概念。\u003c/p\u003e\n\u003ch3 id=\"ecs\"\u003eECS\u003c/h3\u003e\n\u003cp\u003eECS is Amazon Elastic \u003cstrong\u003eContainer Service\u003c/strong\u003e.\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eContainer Orchestration Service (容器编排工具）\u003c/li\u003e\n\u003cli\u003eManages the whole container lifecycle.\n\u003cul\u003e\n\u003cli\u003estart\u003c/li\u003e\n\u003cli\u003ere-schedule\u003c/li\u003e\n\u003cli\u003eload balance\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003eECS Cluster（ECS集群）是Control Plane，管理所有运行着容器的虚拟机器。\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e\u003cimg src=\"https://s2.loli.net/2023/01/09/u8ytTRfvmx7gk4n.jpg\" alt=\"How does ECS work\"\u003e\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e而这些虚拟机是什么？是EC2 Instance，你还是需要管理这些Instance的，比如在增加container的时候，需要确保Instance的资源足够。\u003c/li\u003e\n\u003cli\u003e但如果我们想在AWS上hosting infrastructure。可以用AWS Fargate。那就不需要手动管理Instance，他会根据你想要运行的container来自动分配资源。节省呀！\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch3 id=\"eks\"\u003eEKS\u003c/h3\u003e\n\u003cp\u003eEKS is Elastic \u003cstrong\u003eKubernetes\u003c/strong\u003e Service.\u003c/p\u003e\n\u003cp\u003eKubernetes 是ECS的竞品，非常Popular，所以EKS就是为了在AWS使用Kubernetes推出的。\u003c/p\u003e\n\u003cp\u003eEKS的工作方式和ECS差不多。\u003c/p\u003e\n\u003ch3 id=\"ecr\"\u003eECR\u003c/h3\u003e\n\u003cp\u003eECR is Elastic \u003cstrong\u003eContainer Registry\u003c/strong\u003e, a private docker registry.\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://s2.loli.net/2023/01/09/Lw6m7geKZ9A4YSW.png\" alt=\"whole story, Jenkins involved here!\"\u003e\u003c/p\u003e\n\u003ch3 id=\"elb\"\u003eELB\u003c/h3\u003e\n\u003cp\u003eELB is Elastic load balancing service.\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://s2.loli.net/2023/01/09/EaFjZvJ731LDGRA.png\" alt=\"负载均衡服务\"\u003e\u003c/p\u003e\n\u003cp\u003e使用这样一个 load balancer有很多好处\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e将流量分配给了很多下级实例\u003c/li\u003e\n\u003cli\u003e只暴露出一个入口（DNS）\u003c/li\u003e\n\u003cli\u003e无缝处理下级应用的failures\u003c/li\u003e\n\u003cli\u003e对实例进行健康检查\u003c/li\u003e\n\u003cli\u003e提供https\u003c/li\u003e\n\u003cli\u003e强制使用cookies，所以用户可以访问到同一个instance\u003c/li\u003e\n\u003cli\u003e…\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch3 id=\"aws-lambda\"\u003eAWS lambda\u003c/h3\u003e\n\u003cp\u003e这是一个Serverless服务，基本上可以理解为它提供了根据事件自动触发Function的能力。\u003c/p\u003e\n\u003cp\u003e其中事件可以指的是S3的内容变化，API的请求，或其他各种各样的AWS服务事件。\u003c/p\u003e\n\u003cp\u003e这里涉及到一个概念，Serverless，值得说一说。\u003c/p\u003e\n\u003cp\u003e我个人的理解是这样的：\u003c/p\u003e\n\u003cp\u003e首先Serverless并不是说没有Server，而是Server对用户不可见，which means：\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e不需要手动管理server。\u003c/li\u003e\n\u003cli\u003e会根据使用自动扩容。\u003c/li\u003e\n\u003cli\u003e只有当被使用的时候，才会产生费用（而不是为Server本身付费）。\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e\u003cimg src=\"https://s2.loli.net/2023/01/09/B2oTW3lrEuznZGK.png\" alt=\"\"\u003e\u003c/p\u003e\n\u003ch2 id=\"环境变量\"\u003e环境变量\u003c/h2\u003e\n\u003ch3 id=\"环境变量-in-nextjs\"\u003e环境变量 in Next.js\u003c/h3\u003e\n\u003cp\u003eBefore \u003ccode\u003econst HOST_NAME = 'www.sample.com'\u003c/code\u003e.\u003c/p\u003e\n\u003cp\u003eAfter \u003ccode\u003econst HOST_NAME = 'process.env.NEXT_PUBLIC_HOST_NAME'\u003c/code\u003e.\u003c/p\u003e\n\u003cp\u003e这里涉及到Next.js的一个特性：\u003ca href=\"https://nextjs.org/docs/basic-features/environment-variables#exposing-environment-variables-to-the-browser\" target=\"_blank\" rel=\"nofollow\"\u003eexpose env vars to the browser\u003c/a\u003e。\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eDuring the \u003cstrong\u003ebuild stage\u003c/strong\u003e, next.js will find these env vars start with \u003cstrong\u003eNEXT_PUBLIC_\u003c/strong\u003e and replace them with literal.\u003c/li\u003e\n\u003cli\u003ebuild stage很关键，在CI/CD流程中，可能有build、release等多个环节，在哪里传入环境变量很关键。\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e\u003cstrong\u003eTrick: 如果在一些情形下，我们需要把用于node端的环境变量暴露给浏览器，可以怎么做？\u003c/strong\u003e\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eRead these env vars inside \u003ccode\u003egetServerSideProps\u003c/code\u003e and return them as props. \u003ca href=\"https://nextjs.org/docs/basic-features/data-fetching/get-server-side-props#when-does-getserversideprops-run\" target=\"_blank\" rel=\"nofollow\"\u003eMore to read about it\u003c/a\u003e.\u003c/li\u003e\n\u003c/ul\u003e\n\u003cpre class=\"language-javascript\"\u003e\u003ccode class=\"language-javascript\"\u003e  \u003cspan class=\"token keyword module\"\u003eexport\u003c/span\u003e \u003cspan class=\"token keyword\"\u003econst\u003c/span\u003e \u003cspan class=\"token function-variable function\"\u003egetServerSideProps\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token arrow operator\"\u003e=\u003e\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"token comment\"\u003e// we can read server side env vars here.\u003c/span\u003e\n    \u003cspan class=\"token keyword control-flow\"\u003ereturn\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n      \u003cspan class=\"token literal-property property\"\u003eserverConstants\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"token constant\"\u003eTEST_HOST_NAME\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e process\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token property-access\"\u003eenv\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token constant\"\u003eTEST_HOST_NAME\u003c/span\u003e\n      \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n  \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n  \n  \u003cspan class=\"token comment\"\u003e// client side.\u003c/span\u003e\n  \u003cspan class=\"token keyword module\"\u003eexport\u003c/span\u003e \u003cspan class=\"token keyword\"\u003econst\u003c/span\u003e \u003cspan class=\"token function-variable function\"\u003e\u003cspan class=\"token maybe-class-name\"\u003ePage\u003c/span\u003e\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token parameter\"\u003eprops\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token arrow operator\"\u003e=\u003e\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"token keyword\"\u003econst\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e serverConstants \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e props\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"token keyword control-flow\"\u003ereturn\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\n      \u003cspan class=\"token operator\"\u003e\u0026#x3C;\u003c/span\u003ep\u003cspan class=\"token operator\"\u003e\u003e\u003c/span\u003e\u003cspan class=\"token constant\"\u003eTEST_HOST_NAME\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003eserverConstants\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token constant\"\u003eTEST_HOST_NAME\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token operator\"\u003e\u0026#x3C;\u003c/span\u003e\u003cspan class=\"token operator\"\u003e/\u003c/span\u003ep\u003cspan class=\"token operator\"\u003e\u003e\u003c/span\u003e\n    \u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n  \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch3 id=\"本地环境变量\"\u003e本地环境变量\u003c/h3\u003e\n\u003cp\u003e关于在本地开发中使用环境变量，next.js 已经有了很好的支持，查看 \u003ca href=\"https://nextjs.org/docs/basic-features/environment-variables#loading-environment-variables\" target=\"_blank\" rel=\"nofollow\"\u003e这里\u003c/a\u003e。\u003c/p\u003e\n\u003cp\u003e在实际场景下，可以创建一个.env.local.examlpe文件。\u003c/p\u003e\n\u003cp\u003e开发者可以拷贝该文件并将其作为自己的.env.local文件。\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003e.env.local 不应该被提交到repo中！\u003c/strong\u003e\u003c/p\u003e\n\u003ch3 id=\"环境变量-in-jest\"\u003e环境变量 in Jest\u003c/h3\u003e\n\u003cp\u003e方法是有很多的，按需采用，这里记录两种。\u003c/p\u003e\n\u003ch3 id=\"在jest的setup文件中设置环境变量\"\u003e在jest的setup文件中设置环境变量\u003c/h3\u003e\n\u003cp\u003e\u003ca href=\"https://jestjs.io/docs/configuration#setupfilesafterenv-array\" target=\"_blank\" rel=\"nofollow\"\u003e文档在此\u003c/a\u003e。简单来说，在这里设置的环境变量会作用于每个测试用例文件。\u003c/p\u003e\n\u003cp\u003e适合用于设置默认环境变量，但无法满足需要测试不同的环境变量的场景。\u003c/p\u003e\n\u003ch3 id=\"在测试用例文件中设置环境变量\"\u003e在测试用例文件中设置环境变量\u003c/h3\u003e\n\u003cp\u003e当然我们可以在测试用例文件中设置环境变量。\u003c/p\u003e\n\u003cp\u003e只是要记住，在每个测试用例前，一定要使用 \u003ca href=\"https://jestjs.io/docs/jest-object#jestresetmodules\" target=\"_blank\" rel=\"nofollow\"\u003e\u003cstrong\u003erestModules\u003c/strong\u003e\u003c/a\u003e ，且\u003cstrong\u003e动态引入\u003c/strong\u003e涉及环境变量的模块。\u003c/p\u003e\n\u003cpre class=\"language-javascript\"\u003e\u003ccode class=\"language-javascript\"\u003e\u003cspan class=\"token function\"\u003edescribe\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e'environmental variables'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token arrow operator\"\u003e=\u003e\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"token keyword\"\u003econst\u003c/span\u003e \u003cspan class=\"token constant\"\u003eOLD_ENV\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e process\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token property-access\"\u003eenv\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\n  \u003cspan class=\"token function\"\u003ebeforeEach\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token arrow operator\"\u003e=\u003e\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n    jest\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token method function property-access\"\u003eresetModules\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token comment\"\u003e// Most important - it clears the cache\u003c/span\u003e\n    process\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token property-access\"\u003eenv\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e \u003cspan class=\"token spread operator\"\u003e...\u003c/span\u003e\u003cspan class=\"token constant\"\u003eOLD_ENV\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e \u003cspan class=\"token comment\"\u003e// Make a copy\u003c/span\u003e\n  \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\n  \u003cspan class=\"token function\"\u003eafterAll\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token arrow operator\"\u003e=\u003e\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n    process\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token property-access\"\u003eenv\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token constant\"\u003eOLD_ENV\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e \u003cspan class=\"token comment\"\u003e// Restore old environment\u003c/span\u003e\n  \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\n  \u003cspan class=\"token function\"\u003etest\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e'will receive process.env variables'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token arrow operator\"\u003e=\u003e\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"token comment\"\u003e// Set the variables\u003c/span\u003e\n    process\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token property-access\"\u003eenv\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token constant\"\u003eNODE_ENV\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token string\"\u003e'dev'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n    process\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token property-access\"\u003eenv\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token constant\"\u003ePROXY_PREFIX\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token string\"\u003e'/new-prefix/'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n    process\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token property-access\"\u003eenv\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token constant\"\u003eAPI_URL\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token string\"\u003e'https://new-api.com/'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n    process\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token property-access\"\u003eenv\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token constant\"\u003eAPP_PORT\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token string\"\u003e'7080'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n    process\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token property-access\"\u003eenv\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token constant\"\u003eUSE_PROXY\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token string\"\u003e'false'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\n    \u003cspan class=\"token keyword\"\u003econst\u003c/span\u003e testedModule \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token function\"\u003erequire\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e'../../config/env'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token keyword module\"\u003edefault\u003c/span\u003e \u003cspan class=\"token comment\"\u003e// dynamic import\u003c/span\u003e\n\n    \u003cspan class=\"token comment\"\u003e// ... actual testing\u003c/span\u003e\n  \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch2 id=\"其他\"\u003e其他\u003c/h2\u003e\n\u003ch3 id=\"本地一切安好线上发布缺少依赖可能是\"\u003e本地一切安好，线上发布缺少依赖，可能是？\u003c/h3\u003e\n\u003cp\u003e规则：如果\u003ccode\u003eNODE_ENV\u003c/code\u003e被设置成\u003ccode\u003eproduction\u003c/code\u003e，yarn不会安装\u003ccode\u003edevDependencies\u003c/code\u003e中的依赖，具体可看\u003ca href=\"https://classic.yarnpkg.com/en/docs/cli/install#toc-yarn-install-production-true-false\" target=\"_blank\" rel=\"nofollow\"\u003e这里\u003c/a\u003e。\u003c/p\u003e\n\u003cp\u003e所以这种cmd是合理的：\u003ccode\u003eyarn install \u0026#x26;\u0026#x26; yarn test \u0026#x26;\u0026#x26; NODE_ENV=production yarn export\u003c/code\u003e。\u003c/p\u003e\n\u003cp\u003e相对的，如果\u003ccode\u003eNODE_ENV\u003c/code\u003e被设置的太早，很可能会导致\u003ccode\u003eyarn test\u003c/code\u003e缺少依赖。\u003c/p\u003e\n\u003ch3 id=\"如何更新包组件服务\"\u003e如何更新包/组件/服务\u003c/h3\u003e\n\u003cp\u003e除了更新逻辑，一般还有哪些步骤？\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003e更新测试用例，保证本地测试用例通过。\u003c/li\u003e\n\u003cli\u003e本地成功运行服务。\u003c/li\u003e\n\u003cli\u003e开一个draft PR.\n\u003col\u003e\n\u003cli\u003e将其部署到测试环境。\u003c/li\u003e\n\u003cli\u003e在测试环境成功运行。\u003c/li\u003e\n\u003c/ol\u003e\n\u003c/li\u003e\n\u003cli\u003e更新版本。（视具体情形）\u003c/li\u003e\n\u003cli\u003e找人review。\u003c/li\u003e\n\u003cli\u003e有了approvals，可以merge。\u003c/li\u003e\n\u003cli\u003e其余的就是QA、部署流程等。\u003c/li\u003e\n\u003c/ol\u003e\n\u003ch3 id=\"jwt\"\u003eJWT\u003c/h3\u003e\n\u003cp\u003eJWT（JSON web token）是一种常见的在客户端与服务端间传递信息的方式。\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003e除非知道签名，用户是无法伪造数据的。\u003c/li\u003e\n\u003cli\u003e而header和payload本身是并没有被加密的。\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003e所以在实际应用场景中，任何人都可以查看请求的数据，但不知道签名的普通用户没办法自己构造、篡改请求。\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"https://en.wikipedia.org/wiki/JSON_Web_Token\" target=\"_blank\" rel=\"nofollow\"\u003e进一步了解JWT\u003c/a\u003e。\u003c/p\u003e\n\u003ch3 id=\"yarn2\"\u003eYarn2\u003c/h3\u003e\n\u003cp\u003eYarn2 = \u003cstrong\u003eyarn berry\u003c/strong\u003e（更加准确）。和 yarn 1.x 比起来算是大改。\u003c/p\u003e\n\u003cp\u003e如果使用PnP特性，yarn会生成\u003ccode\u003e.pnp.cjs\u003c/code\u003e以代替\u003ccode\u003enode_modules\u003c/code\u003e。\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003e.pnp.cjs\u003c/code\u003e只是一些maps，包括如何在文件系统中找到packages。\u003c/p\u003e\n\u003cp\u003e而packages本身，是被zipped压缩过的，所以文件的数量远远少于\u003ccode\u003enode_modules\u003c/code\u003e。\u003c/p\u003e\n\u003cp\u003e尽管package被压缩过，我们仍然可以借助\u003ccode\u003efs\u003c/code\u003e的能力读取文件。\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003e更多yarn2，欢迎阅读：\u003c/strong\u003e\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"https://blog.logrocket.com/javascript-package-managers-compared/\" target=\"_blank\" rel=\"nofollow\"\u003eJavaScript package managers compared: npm, Yarn, or pnpm?\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://www.yarnpkg.cn/features/pnp\" target=\"_blank\" rel=\"nofollow\"\u003ePlug'n'Play\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch3 id=\"线上监控服务异常排查\"\u003e线上监控服务异常排查\u003c/h3\u003e\n\u003cp\u003e如果怀疑有异常的线上流量，如何排查：\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003e调整时间区间，来观察流量是否是一瞬间涌入的。\u003c/li\u003e\n\u003cli\u003e比较服务端和客户端的流量，观察流量是否是直接打到服务端的。\u003c/li\u003e\n\u003cli\u003e比较流量峰值日志是否有共同点：Client IP, Country, Region, City…\u003c/li\u003e\n\u003c/ol\u003e\n\u003c/body\u003e\u003c/html\u003e","description":"最近结束的一个项目有很多值得学习的地方，挑一些不敏感的在此记录。其中的每一点其实都有深入挖掘的空间，日后想必会再次遇到。......"},"__N_SSG":true},"page":"/posts/[id]","query":{"id":"R-project-summary"},"buildId":"L_CyqIx4aqZcAL1u9DngY","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>