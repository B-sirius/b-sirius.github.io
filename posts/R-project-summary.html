<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width"/><title>LWDW!</title><meta name="description" content="Ré¡¹ç›®å°ç»“"/><meta property="og:title" content="Ré¡¹ç›®å°ç»“"/><meta property="og:description" content="æœ€è¿‘ç»“æŸçš„ä¸€ä¸ªé¡¹ç›®æœ‰å¾ˆå¤šå€¼å¾—å­¦ä¹ çš„åœ°æ–¹ï¼ŒæŒ‘ä¸€äº›ä¸æ•æ„Ÿçš„åœ¨æ­¤è®°å½•ã€‚å…¶ä¸­çš„æ¯ä¸€ç‚¹å…¶å®éƒ½æœ‰æ·±å…¥æŒ–æ˜çš„ç©ºé—´ï¼Œæ—¥åæƒ³å¿…ä¼šå†æ¬¡é‡åˆ°ã€‚......"/><meta name="next-head-count" content="6"/><link rel="apple-touch-icon" sizes="180x180" href="/favicon/apple-touch-icon.png"/><link rel="icon" type="image/png" sizes="32x32" href="/favicon/favicon-32x32.png"/><link rel="icon" type="image/png" sizes="16x16" href="/favicon/favicon-16x16.png"/><link rel="manifest" href="/favicon/site.webmanifest"/><link rel="mask-icon" href="/favicon/safari-pinned-tab.svg" color="#ffffff"/><meta name="msapplication-TileColor" content="#ffffff"/><meta name="theme-color" content="#000"/><meta property="og:type" content="website"/><meta property="og:image" content="https://s2.loli.net/2023/01/18/42YTZxzePtR7jy9.png"/><meta property="og:url" content="https://b-sirius.github.io"/><link rel="preload" href="/_next/static/css/aef510c8abf24c2c.css" as="style"/><link rel="stylesheet" href="/_next/static/css/aef510c8abf24c2c.css" data-n-g=""/><link rel="preload" href="/_next/static/css/b51a0fb142b75fa0.css" as="style"/><link rel="stylesheet" href="/_next/static/css/b51a0fb142b75fa0.css" data-n-p=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-c67a75d1b6f99dc8.js"></script><script src="/_next/static/chunks/webpack-f164db4954bac6ec.js" defer=""></script><script src="/_next/static/chunks/framework-114634acb84f8baa.js" defer=""></script><script src="/_next/static/chunks/main-673a4fae4a27af6a.js" defer=""></script><script src="/_next/static/chunks/pages/_app-0da236044dc4e5fc.js" defer=""></script><script src="/_next/static/chunks/664-1b4479b4462ded63.js" defer=""></script><script src="/_next/static/chunks/332-e879213584d084bf.js" defer=""></script><script src="/_next/static/chunks/pages/posts/%5Bid%5D-f9bad91587257bf5.js" defer=""></script><script src="/_next/static/L_CyqIx4aqZcAL1u9DngY/_buildManifest.js" defer=""></script><script src="/_next/static/L_CyqIx4aqZcAL1u9DngY/_ssgManifest.js" defer=""></script></head><body><div id="__next"><div class="sc-590e23a2-0 iUjvom"><div class="sc-7fa12c98-0 iqAzDm"><div class="sc-357ac6e1-1 blSmbb"><div class="sc-357ac6e1-0 fqUBXX"><a class="sc-357ac6e1-2 gfNIvm" href="/">[<!-- -->Home<!-- -->]</a><a class="sc-357ac6e1-2 gfNIvm" href="/posts">[<!-- -->Posts<!-- -->]</a><a class="sc-357ac6e1-3 eNeEmH" rel="noopener noreferrer" target="_blank" href="https://github.com/B-sirius">[<!-- -->Github<!-- -->]</a><a class="sc-357ac6e1-3 eNeEmH" rel="noopener noreferrer" target="_blank" href="https://b-sirius.github.io/rss.xml">[<!-- -->RSS<!-- -->]</a></div><div class="sc-f5ce872-0 drvesR"><h1 class="sc-f5ce872-1 jPBPjm">LWDW!</h1><p class="sc-f5ce872-2 djaGsH">Learn the work from doing the workğŸº</p></div></div><div class="sc-920e94b6-0 sc-659069c1-0 cMfBpD jHWfVM"><div><div class="sc-32c5999b-0 iFBmZi"><div class="sc-32c5999b-2 fHkOeB">Ré¡¹ç›®å°ç»“</div><div class="sc-32c5999b-3 deKveP">Posted on <!-- -->2023-01-09</div></div></div></div><div class="sc-920e94b6-0 cMfBpD"><div><div class="sc-32c5999b-1 fNXLto"><div class="sc-a2d97488-0 dmbacr"><div><html><head></head><body><p>æœ€è¿‘ç»“æŸçš„ä¸€ä¸ªé¡¹ç›®æœ‰å¾ˆå¤šå€¼å¾—å­¦ä¹ çš„åœ°æ–¹ï¼ŒæŒ‘ä¸€äº›ä¸æ•æ„Ÿçš„åœ¨æ­¤è®°å½•ã€‚å…¶ä¸­çš„æ¯ä¸€ç‚¹å…¶å®éƒ½æœ‰æ·±å…¥æŒ–æ˜çš„ç©ºé—´ï¼Œæ—¥åæƒ³å¿…ä¼šå†æ¬¡é‡åˆ°ã€‚</p>
<hr>
<h2 id="æ–‡æ¡£è®¾è®¡">æ–‡æ¡£è®¾è®¡</h2>
<p>æœ‰å“ªäº›æ–‡æ¡£å¯ä»¥æ•´ç†å½’æ€»ï¼Ÿæœ‰çš„æ–‡æ¡£é€‚åˆå•ç‹¬æ€»ç»“ï¼Œæœ‰çš„é€‚åˆæ”¾åœ¨Readmeä¸­ï¼Œä½†æ€»ä¹‹ï¼Œä»¥ä¸‹æ˜¯ä¸€äº›å¯ä»¥è€ƒè™‘çš„ç‚¹ã€‚</p>
<h3 id="ç³»ç»Ÿè®¾è®¡æ–‡æ¡£">ç³»ç»Ÿè®¾è®¡æ–‡æ¡£</h3>
<p>è¿™é‡Œçš„è®¾è®¡æŒ‡çš„æ˜¯ç³»ç»Ÿçš„æ¶æ„ï¼Œå°¤å…¶è¦å…³æ³¨<strong>ç³»ç»Ÿä¹‹é—´æ˜¯å¦‚ä½•è¿æ¥çš„</strong>ã€‚</p>
<p>è€Œä»¥ä¸‹å†…å®¹ä¸åº”è¯¥è¢«åŒ…å«åœ¨å…¶ä¸­ï¼š</p>
<ul>
<li>æœåŠ¡çš„å…·ä½“ç»†èŠ‚ã€‚</li>
<li>ç»„ä»¶çš„è®¾è®¡æ¨¡å¼ã€‚</li>
</ul>
<h3 id="ç»„ä»¶æ–‡æ¡£">ç»„ä»¶æ–‡æ¡£</h3>
<p>æ•´ç†æ‰€æœ‰çš„ç»„ä»¶/æœåŠ¡ï¼Œå¯ä»¥æœ‰ä»¥ä¸‹å…³æ³¨ç‚¹ï¼š</p>
<ul>
<li>ä»‹ç»</li>
<li>æœåŠ¡ç±»å‹ï¼ˆæ¯”å¦‚SSR /Staticï¼‰</li>
<li>è·¯ç”±å‰ç¼€</li>
<li>ç”Ÿäº§ç¯å¢ƒåŸŸå</li>
<li>é¢„å‘ç¯å¢ƒåŸŸå</li>
<li>æµ‹è¯•ç¯å¢ƒåŸŸåï¼ˆè§„åˆ™ï¼‰</li>
<li>ä»“åº“åœ°å€</li>
<li>æµæ°´çº¿åœ°å€</li>
<li>å‘å¸ƒåˆ†æ”¯</li>
<li>æ¶‰åŠæŠ€æœ¯æ ˆ</li>
</ul>
<h3 id="å¼€å‘è€…faq">å¼€å‘è€…FAQ</h3>
<p>ç›®çš„æ˜¯æ”¶é›†å¼€å‘è€…å…³å¿ƒçš„å¸¸è§é—®é¢˜ï¼Œæ¯”å¦‚é¡¹ç›®å¦‚ä½•æœ¬åœ°å¯åŠ¨ï¼Œå¿…è¦æƒé™å¦‚ä½•ç”³è¯·ç­‰ã€‚</p>
<h3 id="å¼€å‘è€…éªŒè¯æŒ‡å—">å¼€å‘è€…éªŒè¯æŒ‡å—</h3>
<p>ç›®çš„æ˜¯ä¿è¯å¼€å‘è€…æäº¤çš„ç»„ä»¶å¯ä»¥åœ¨ç”Ÿäº§ç¯å¢ƒä¸­è¿è¡Œï¼Œè€Œä¸æ˜¯å®Œå…¨ä¾èµ–QAã€‚å¸¸è§çš„æ‰‹æ®µæœ‰æµ‹è¯•ç”¨ä¾‹ï¼Œcode reviewç­‰ï¼Œä¸”å¾ˆå¯èƒ½ä¸CI/CDæµç¨‹æœ‰å…³ã€‚ä¸ªäººè§‰å¾—å¼€å‘è€…å¾ˆå®¹æ˜“å¯¹ä¸€äº›å°æ”¹åŠ¨æœ‰è¿·ä¹‹è‡ªä¿¡ï¼Œç»“æœå´æäº¤æ— æ³•åœ¨æµ‹è¯•ç¯å¢ƒè¿è¡Œçš„ä»£ç ç”šè‡³æå´©çº¿ä¸Šã€‚è¯¥æ­¥éª¤éå¸¸é‡è¦åˆå®¹æ˜“è¢«å¿½è§†ã€‚</p>
<h2 id="awsæœåŠ¡">AWSæœåŠ¡</h2>
<p>awsæœåŠ¡å¤ªå¸¸è§äº†ï¼Œç¨å¾®è®°å½•ä¸€ä¸‹æˆ‘æœ¬æ¬¡æ¥è§¦çš„ï¼Œä¸è‡³äºä¸€äº›åè¯éƒ½æ²¡æœ‰æ¦‚å¿µã€‚</p>
<h3 id="ecs">ECS</h3>
<p>ECS is Amazon Elastic <strong>Container Service</strong>.</p>
<ul>
<li>Container Orchestration Service (å®¹å™¨ç¼–æ’å·¥å…·ï¼‰</li>
<li>Manages the whole container lifecycle.
<ul>
<li>start</li>
<li>re-schedule</li>
<li>load balance</li>
</ul>
</li>
<li>ECS Clusterï¼ˆECSé›†ç¾¤ï¼‰æ˜¯Control Planeï¼Œç®¡ç†æ‰€æœ‰è¿è¡Œç€å®¹å™¨çš„è™šæ‹Ÿæœºå™¨ã€‚</li>
</ul>
<p><img src="https://s2.loli.net/2023/01/09/u8ytTRfvmx7gk4n.jpg" alt="How does ECS work"></p>
<ul>
<li>è€Œè¿™äº›è™šæ‹Ÿæœºæ˜¯ä»€ä¹ˆï¼Ÿæ˜¯EC2 Instanceï¼Œä½ è¿˜æ˜¯éœ€è¦ç®¡ç†è¿™äº›Instanceçš„ï¼Œæ¯”å¦‚åœ¨å¢åŠ containerçš„æ—¶å€™ï¼Œéœ€è¦ç¡®ä¿Instanceçš„èµ„æºè¶³å¤Ÿã€‚</li>
<li>ä½†å¦‚æœæˆ‘ä»¬æƒ³åœ¨AWSä¸Šhosting infrastructureã€‚å¯ä»¥ç”¨AWS Fargateã€‚é‚£å°±ä¸éœ€è¦æ‰‹åŠ¨ç®¡ç†Instanceï¼Œä»–ä¼šæ ¹æ®ä½ æƒ³è¦è¿è¡Œçš„containeræ¥è‡ªåŠ¨åˆ†é…èµ„æºã€‚èŠ‚çœå‘€ï¼</li>
</ul>
<h3 id="eks">EKS</h3>
<p>EKS is Elastic <strong>Kubernetes</strong> Service.</p>
<p>Kubernetes æ˜¯ECSçš„ç«å“ï¼Œéå¸¸Popularï¼Œæ‰€ä»¥EKSå°±æ˜¯ä¸ºäº†åœ¨AWSä½¿ç”¨Kubernetesæ¨å‡ºçš„ã€‚</p>
<p>EKSçš„å·¥ä½œæ–¹å¼å’ŒECSå·®ä¸å¤šã€‚</p>
<h3 id="ecr">ECR</h3>
<p>ECR is Elastic <strong>Container Registry</strong>, a private docker registry.</p>
<p><img src="https://s2.loli.net/2023/01/09/Lw6m7geKZ9A4YSW.png" alt="whole story, Jenkins involved here!"></p>
<h3 id="elb">ELB</h3>
<p>ELB is Elastic load balancing service.</p>
<p><img src="https://s2.loli.net/2023/01/09/EaFjZvJ731LDGRA.png" alt="è´Ÿè½½å‡è¡¡æœåŠ¡"></p>
<p>ä½¿ç”¨è¿™æ ·ä¸€ä¸ª load balanceræœ‰å¾ˆå¤šå¥½å¤„</p>
<ul>
<li>å°†æµé‡åˆ†é…ç»™äº†å¾ˆå¤šä¸‹çº§å®ä¾‹</li>
<li>åªæš´éœ²å‡ºä¸€ä¸ªå…¥å£ï¼ˆDNSï¼‰</li>
<li>æ— ç¼å¤„ç†ä¸‹çº§åº”ç”¨çš„failures</li>
<li>å¯¹å®ä¾‹è¿›è¡Œå¥åº·æ£€æŸ¥</li>
<li>æä¾›https</li>
<li>å¼ºåˆ¶ä½¿ç”¨cookiesï¼Œæ‰€ä»¥ç”¨æˆ·å¯ä»¥è®¿é—®åˆ°åŒä¸€ä¸ªinstance</li>
<li>â€¦</li>
</ul>
<h3 id="aws-lambda">AWS lambda</h3>
<p>è¿™æ˜¯ä¸€ä¸ªServerlessæœåŠ¡ï¼ŒåŸºæœ¬ä¸Šå¯ä»¥ç†è§£ä¸ºå®ƒæä¾›äº†æ ¹æ®äº‹ä»¶è‡ªåŠ¨è§¦å‘Functionçš„èƒ½åŠ›ã€‚</p>
<p>å…¶ä¸­äº‹ä»¶å¯ä»¥æŒ‡çš„æ˜¯S3çš„å†…å®¹å˜åŒ–ï¼ŒAPIçš„è¯·æ±‚ï¼Œæˆ–å…¶ä»–å„ç§å„æ ·çš„AWSæœåŠ¡äº‹ä»¶ã€‚</p>
<p>è¿™é‡Œæ¶‰åŠåˆ°ä¸€ä¸ªæ¦‚å¿µï¼ŒServerlessï¼Œå€¼å¾—è¯´ä¸€è¯´ã€‚</p>
<p>æˆ‘ä¸ªäººçš„ç†è§£æ˜¯è¿™æ ·çš„ï¼š</p>
<p>é¦–å…ˆServerlesså¹¶ä¸æ˜¯è¯´æ²¡æœ‰Serverï¼Œè€Œæ˜¯Serverå¯¹ç”¨æˆ·ä¸å¯è§ï¼Œwhich meansï¼š</p>
<ul>
<li>ä¸éœ€è¦æ‰‹åŠ¨ç®¡ç†serverã€‚</li>
<li>ä¼šæ ¹æ®ä½¿ç”¨è‡ªåŠ¨æ‰©å®¹ã€‚</li>
<li>åªæœ‰å½“è¢«ä½¿ç”¨çš„æ—¶å€™ï¼Œæ‰ä¼šäº§ç”Ÿè´¹ç”¨ï¼ˆè€Œä¸æ˜¯ä¸ºServeræœ¬èº«ä»˜è´¹ï¼‰ã€‚</li>
</ul>
<p><img src="https://s2.loli.net/2023/01/09/B2oTW3lrEuznZGK.png" alt=""></p>
<h2 id="ç¯å¢ƒå˜é‡">ç¯å¢ƒå˜é‡</h2>
<h3 id="ç¯å¢ƒå˜é‡-in-nextjs">ç¯å¢ƒå˜é‡ in Next.js</h3>
<p>Before <code>const HOST_NAME = 'www.sample.com'</code>.</p>
<p>After <code>const HOST_NAME = 'process.env.NEXT_PUBLIC_HOST_NAME'</code>.</p>
<p>è¿™é‡Œæ¶‰åŠåˆ°Next.jsçš„ä¸€ä¸ªç‰¹æ€§ï¼š<a href="https://nextjs.org/docs/basic-features/environment-variables#exposing-environment-variables-to-the-browser" target="_blank" rel="nofollow">expose env vars to the browser</a>ã€‚</p>
<ul>
<li>During the <strong>build stage</strong>, next.js will find these env vars start with <strong>NEXT_PUBLIC_</strong> and replace them with literal.</li>
<li>build stageå¾ˆå…³é”®ï¼Œåœ¨CI/CDæµç¨‹ä¸­ï¼Œå¯èƒ½æœ‰buildã€releaseç­‰å¤šä¸ªç¯èŠ‚ï¼Œåœ¨å“ªé‡Œä¼ å…¥ç¯å¢ƒå˜é‡å¾ˆå…³é”®ã€‚</li>
</ul>
<p><strong>Trick: å¦‚æœåœ¨ä¸€äº›æƒ…å½¢ä¸‹ï¼Œæˆ‘ä»¬éœ€è¦æŠŠç”¨äºnodeç«¯çš„ç¯å¢ƒå˜é‡æš´éœ²ç»™æµè§ˆå™¨ï¼Œå¯ä»¥æ€ä¹ˆåšï¼Ÿ</strong></p>
<ul>
<li>Read these env vars inside <code>getServerSideProps</code> and return them as props. <a href="https://nextjs.org/docs/basic-features/data-fetching/get-server-side-props#when-does-getserversideprops-run" target="_blank" rel="nofollow">More to read about it</a>.</li>
</ul>
<pre class="language-javascript"><code class="language-javascript">  <span class="token keyword module">export</span> <span class="token keyword">const</span> <span class="token function-variable function">getServerSideProps</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token comment">// we can read server side env vars here.</span>
    <span class="token keyword control-flow">return</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">serverConstants</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token constant">TEST_HOST_NAME</span><span class="token operator">:</span> process<span class="token punctuation">.</span><span class="token property-access">env</span><span class="token punctuation">.</span><span class="token constant">TEST_HOST_NAME</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  
  <span class="token comment">// client side.</span>
  <span class="token keyword module">export</span> <span class="token keyword">const</span> <span class="token function-variable function"><span class="token maybe-class-name">Page</span></span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> serverConstants <span class="token punctuation">}</span> <span class="token operator">=</span> props<span class="token punctuation">;</span>
    <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
      <span class="token operator">&#x3C;</span>p<span class="token operator">></span><span class="token constant">TEST_HOST_NAME</span><span class="token operator">:</span> <span class="token punctuation">{</span>serverConstants<span class="token punctuation">.</span><span class="token constant">TEST_HOST_NAME</span><span class="token punctuation">}</span><span class="token operator">&#x3C;</span><span class="token operator">/</span>p<span class="token operator">></span>
    <span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
</code></pre>
<h3 id="æœ¬åœ°ç¯å¢ƒå˜é‡">æœ¬åœ°ç¯å¢ƒå˜é‡</h3>
<p>å…³äºåœ¨æœ¬åœ°å¼€å‘ä¸­ä½¿ç”¨ç¯å¢ƒå˜é‡ï¼Œnext.js å·²ç»æœ‰äº†å¾ˆå¥½çš„æ”¯æŒï¼ŒæŸ¥çœ‹ <a href="https://nextjs.org/docs/basic-features/environment-variables#loading-environment-variables" target="_blank" rel="nofollow">è¿™é‡Œ</a>ã€‚</p>
<p>åœ¨å®é™…åœºæ™¯ä¸‹ï¼Œå¯ä»¥åˆ›å»ºä¸€ä¸ª.env.local.examlpeæ–‡ä»¶ã€‚</p>
<p>å¼€å‘è€…å¯ä»¥æ‹·è´è¯¥æ–‡ä»¶å¹¶å°†å…¶ä½œä¸ºè‡ªå·±çš„.env.localæ–‡ä»¶ã€‚</p>
<p><strong>.env.local ä¸åº”è¯¥è¢«æäº¤åˆ°repoä¸­ï¼</strong></p>
<h3 id="ç¯å¢ƒå˜é‡-in-jest">ç¯å¢ƒå˜é‡ in Jest</h3>
<p>æ–¹æ³•æ˜¯æœ‰å¾ˆå¤šçš„ï¼ŒæŒ‰éœ€é‡‡ç”¨ï¼Œè¿™é‡Œè®°å½•ä¸¤ç§ã€‚</p>
<h3 id="åœ¨jestçš„setupæ–‡ä»¶ä¸­è®¾ç½®ç¯å¢ƒå˜é‡">åœ¨jestçš„setupæ–‡ä»¶ä¸­è®¾ç½®ç¯å¢ƒå˜é‡</h3>
<p><a href="https://jestjs.io/docs/configuration#setupfilesafterenv-array" target="_blank" rel="nofollow">æ–‡æ¡£åœ¨æ­¤</a>ã€‚ç®€å•æ¥è¯´ï¼Œåœ¨è¿™é‡Œè®¾ç½®çš„ç¯å¢ƒå˜é‡ä¼šä½œç”¨äºæ¯ä¸ªæµ‹è¯•ç”¨ä¾‹æ–‡ä»¶ã€‚</p>
<p>é€‚åˆç”¨äºè®¾ç½®é»˜è®¤ç¯å¢ƒå˜é‡ï¼Œä½†æ— æ³•æ»¡è¶³éœ€è¦æµ‹è¯•ä¸åŒçš„ç¯å¢ƒå˜é‡çš„åœºæ™¯ã€‚</p>
<h3 id="åœ¨æµ‹è¯•ç”¨ä¾‹æ–‡ä»¶ä¸­è®¾ç½®ç¯å¢ƒå˜é‡">åœ¨æµ‹è¯•ç”¨ä¾‹æ–‡ä»¶ä¸­è®¾ç½®ç¯å¢ƒå˜é‡</h3>
<p>å½“ç„¶æˆ‘ä»¬å¯ä»¥åœ¨æµ‹è¯•ç”¨ä¾‹æ–‡ä»¶ä¸­è®¾ç½®ç¯å¢ƒå˜é‡ã€‚</p>
<p>åªæ˜¯è¦è®°ä½ï¼Œåœ¨æ¯ä¸ªæµ‹è¯•ç”¨ä¾‹å‰ï¼Œä¸€å®šè¦ä½¿ç”¨ <a href="https://jestjs.io/docs/jest-object#jestresetmodules" target="_blank" rel="nofollow"><strong>restModules</strong></a> ï¼Œä¸”<strong>åŠ¨æ€å¼•å…¥</strong>æ¶‰åŠç¯å¢ƒå˜é‡çš„æ¨¡å—ã€‚</p>
<pre class="language-javascript"><code class="language-javascript"><span class="token function">describe</span><span class="token punctuation">(</span><span class="token string">'environmental variables'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token constant">OLD_ENV</span> <span class="token operator">=</span> process<span class="token punctuation">.</span><span class="token property-access">env</span><span class="token punctuation">;</span>

  <span class="token function">beforeEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    jest<span class="token punctuation">.</span><span class="token method function property-access">resetModules</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// Most important - it clears the cache</span>
    process<span class="token punctuation">.</span><span class="token property-access">env</span> <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token spread operator">...</span><span class="token constant">OLD_ENV</span> <span class="token punctuation">}</span><span class="token punctuation">;</span> <span class="token comment">// Make a copy</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token function">afterAll</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    process<span class="token punctuation">.</span><span class="token property-access">env</span> <span class="token operator">=</span> <span class="token constant">OLD_ENV</span><span class="token punctuation">;</span> <span class="token comment">// Restore old environment</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'will receive process.env variables'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token comment">// Set the variables</span>
    process<span class="token punctuation">.</span><span class="token property-access">env</span><span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">=</span> <span class="token string">'dev'</span><span class="token punctuation">;</span>
    process<span class="token punctuation">.</span><span class="token property-access">env</span><span class="token punctuation">.</span><span class="token constant">PROXY_PREFIX</span> <span class="token operator">=</span> <span class="token string">'/new-prefix/'</span><span class="token punctuation">;</span>
    process<span class="token punctuation">.</span><span class="token property-access">env</span><span class="token punctuation">.</span><span class="token constant">API_URL</span> <span class="token operator">=</span> <span class="token string">'https://new-api.com/'</span><span class="token punctuation">;</span>
    process<span class="token punctuation">.</span><span class="token property-access">env</span><span class="token punctuation">.</span><span class="token constant">APP_PORT</span> <span class="token operator">=</span> <span class="token string">'7080'</span><span class="token punctuation">;</span>
    process<span class="token punctuation">.</span><span class="token property-access">env</span><span class="token punctuation">.</span><span class="token constant">USE_PROXY</span> <span class="token operator">=</span> <span class="token string">'false'</span><span class="token punctuation">;</span>

    <span class="token keyword">const</span> testedModule <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'../../config/env'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword module">default</span> <span class="token comment">// dynamic import</span>

    <span class="token comment">// ... actual testing</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<h2 id="å…¶ä»–">å…¶ä»–</h2>
<h3 id="æœ¬åœ°ä¸€åˆ‡å®‰å¥½çº¿ä¸Šå‘å¸ƒç¼ºå°‘ä¾èµ–å¯èƒ½æ˜¯">æœ¬åœ°ä¸€åˆ‡å®‰å¥½ï¼Œçº¿ä¸Šå‘å¸ƒç¼ºå°‘ä¾èµ–ï¼Œå¯èƒ½æ˜¯ï¼Ÿ</h3>
<p>è§„åˆ™ï¼šå¦‚æœ<code>NODE_ENV</code>è¢«è®¾ç½®æˆ<code>production</code>ï¼Œyarnä¸ä¼šå®‰è£…<code>devDependencies</code>ä¸­çš„ä¾èµ–ï¼Œå…·ä½“å¯çœ‹<a href="https://classic.yarnpkg.com/en/docs/cli/install#toc-yarn-install-production-true-false" target="_blank" rel="nofollow">è¿™é‡Œ</a>ã€‚</p>
<p>æ‰€ä»¥è¿™ç§cmdæ˜¯åˆç†çš„ï¼š<code>yarn install &#x26;&#x26; yarn test &#x26;&#x26; NODE_ENV=production yarn export</code>ã€‚</p>
<p>ç›¸å¯¹çš„ï¼Œå¦‚æœ<code>NODE_ENV</code>è¢«è®¾ç½®çš„å¤ªæ—©ï¼Œå¾ˆå¯èƒ½ä¼šå¯¼è‡´<code>yarn test</code>ç¼ºå°‘ä¾èµ–ã€‚</p>
<h3 id="å¦‚ä½•æ›´æ–°åŒ…ç»„ä»¶æœåŠ¡">å¦‚ä½•æ›´æ–°åŒ…/ç»„ä»¶/æœåŠ¡</h3>
<p>é™¤äº†æ›´æ–°é€»è¾‘ï¼Œä¸€èˆ¬è¿˜æœ‰å“ªäº›æ­¥éª¤ï¼Ÿ</p>
<ol>
<li>æ›´æ–°æµ‹è¯•ç”¨ä¾‹ï¼Œä¿è¯æœ¬åœ°æµ‹è¯•ç”¨ä¾‹é€šè¿‡ã€‚</li>
<li>æœ¬åœ°æˆåŠŸè¿è¡ŒæœåŠ¡ã€‚</li>
<li>å¼€ä¸€ä¸ªdraft PR.
<ol>
<li>å°†å…¶éƒ¨ç½²åˆ°æµ‹è¯•ç¯å¢ƒã€‚</li>
<li>åœ¨æµ‹è¯•ç¯å¢ƒæˆåŠŸè¿è¡Œã€‚</li>
</ol>
</li>
<li>æ›´æ–°ç‰ˆæœ¬ã€‚ï¼ˆè§†å…·ä½“æƒ…å½¢ï¼‰</li>
<li>æ‰¾äººreviewã€‚</li>
<li>æœ‰äº†approvalsï¼Œå¯ä»¥mergeã€‚</li>
<li>å…¶ä½™çš„å°±æ˜¯QAã€éƒ¨ç½²æµç¨‹ç­‰ã€‚</li>
</ol>
<h3 id="jwt">JWT</h3>
<p>JWTï¼ˆJSON web tokenï¼‰æ˜¯ä¸€ç§å¸¸è§çš„åœ¨å®¢æˆ·ç«¯ä¸æœåŠ¡ç«¯é—´ä¼ é€’ä¿¡æ¯çš„æ–¹å¼ã€‚</p>
<ol>
<li>é™¤éçŸ¥é“ç­¾åï¼Œç”¨æˆ·æ˜¯æ— æ³•ä¼ªé€ æ•°æ®çš„ã€‚</li>
<li>è€Œheaderå’Œpayloadæœ¬èº«æ˜¯å¹¶æ²¡æœ‰è¢«åŠ å¯†çš„ã€‚</li>
</ol>
<p>æ‰€ä»¥åœ¨å®é™…åº”ç”¨åœºæ™¯ä¸­ï¼Œä»»ä½•äººéƒ½å¯ä»¥æŸ¥çœ‹è¯·æ±‚çš„æ•°æ®ï¼Œä½†ä¸çŸ¥é“ç­¾åçš„æ™®é€šç”¨æˆ·æ²¡åŠæ³•è‡ªå·±æ„é€ ã€ç¯¡æ”¹è¯·æ±‚ã€‚</p>
<p><a href="https://en.wikipedia.org/wiki/JSON_Web_Token" target="_blank" rel="nofollow">è¿›ä¸€æ­¥äº†è§£JWT</a>ã€‚</p>
<h3 id="yarn2">Yarn2</h3>
<p>Yarn2 = <strong>yarn berry</strong>ï¼ˆæ›´åŠ å‡†ç¡®ï¼‰ã€‚å’Œ yarn 1.x æ¯”èµ·æ¥ç®—æ˜¯å¤§æ”¹ã€‚</p>
<p>å¦‚æœä½¿ç”¨PnPç‰¹æ€§ï¼Œyarnä¼šç”Ÿæˆ<code>.pnp.cjs</code>ä»¥ä»£æ›¿<code>node_modules</code>ã€‚</p>
<p><code>.pnp.cjs</code>åªæ˜¯ä¸€äº›mapsï¼ŒåŒ…æ‹¬å¦‚ä½•åœ¨æ–‡ä»¶ç³»ç»Ÿä¸­æ‰¾åˆ°packagesã€‚</p>
<p>è€Œpackagesæœ¬èº«ï¼Œæ˜¯è¢«zippedå‹ç¼©è¿‡çš„ï¼Œæ‰€ä»¥æ–‡ä»¶çš„æ•°é‡è¿œè¿œå°‘äº<code>node_modules</code>ã€‚</p>
<p>å°½ç®¡packageè¢«å‹ç¼©è¿‡ï¼Œæˆ‘ä»¬ä»ç„¶å¯ä»¥å€ŸåŠ©<code>fs</code>çš„èƒ½åŠ›è¯»å–æ–‡ä»¶ã€‚</p>
<p><strong>æ›´å¤šyarn2ï¼Œæ¬¢è¿é˜…è¯»ï¼š</strong></p>
<ul>
<li><a href="https://blog.logrocket.com/javascript-package-managers-compared/" target="_blank" rel="nofollow">JavaScript package managers compared: npm, Yarn, or pnpm?</a></li>
<li><a href="https://www.yarnpkg.cn/features/pnp" target="_blank" rel="nofollow">Plug'n'Play</a></li>
</ul>
<h3 id="çº¿ä¸Šç›‘æ§æœåŠ¡å¼‚å¸¸æ’æŸ¥">çº¿ä¸Šç›‘æ§æœåŠ¡å¼‚å¸¸æ’æŸ¥</h3>
<p>å¦‚æœæ€€ç–‘æœ‰å¼‚å¸¸çš„çº¿ä¸Šæµé‡ï¼Œå¦‚ä½•æ’æŸ¥ï¼š</p>
<ol>
<li>è°ƒæ•´æ—¶é—´åŒºé—´ï¼Œæ¥è§‚å¯Ÿæµé‡æ˜¯å¦æ˜¯ä¸€ç¬é—´æ¶Œå…¥çš„ã€‚</li>
<li>æ¯”è¾ƒæœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯çš„æµé‡ï¼Œè§‚å¯Ÿæµé‡æ˜¯å¦æ˜¯ç›´æ¥æ‰“åˆ°æœåŠ¡ç«¯çš„ã€‚</li>
<li>æ¯”è¾ƒæµé‡å³°å€¼æ—¥å¿—æ˜¯å¦æœ‰å…±åŒç‚¹ï¼šClient IP, Country, Region, Cityâ€¦</li>
</ol>
</body></html></div></div></div></div></div><div class="sc-bbd5e802-0 cbkQsN"><div></div></div></div></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"id":"R-project-summary","title":"Ré¡¹ç›®å°ç»“","date":"2023-01-09","htmlText":"\u003chtml\u003e\u003chead\u003e\u003c/head\u003e\u003cbody\u003e\u003cp\u003eæœ€è¿‘ç»“æŸçš„ä¸€ä¸ªé¡¹ç›®æœ‰å¾ˆå¤šå€¼å¾—å­¦ä¹ çš„åœ°æ–¹ï¼ŒæŒ‘ä¸€äº›ä¸æ•æ„Ÿçš„åœ¨æ­¤è®°å½•ã€‚å…¶ä¸­çš„æ¯ä¸€ç‚¹å…¶å®éƒ½æœ‰æ·±å…¥æŒ–æ˜çš„ç©ºé—´ï¼Œæ—¥åæƒ³å¿…ä¼šå†æ¬¡é‡åˆ°ã€‚\u003c/p\u003e\n\u003chr\u003e\n\u003ch2 id=\"æ–‡æ¡£è®¾è®¡\"\u003eæ–‡æ¡£è®¾è®¡\u003c/h2\u003e\n\u003cp\u003eæœ‰å“ªäº›æ–‡æ¡£å¯ä»¥æ•´ç†å½’æ€»ï¼Ÿæœ‰çš„æ–‡æ¡£é€‚åˆå•ç‹¬æ€»ç»“ï¼Œæœ‰çš„é€‚åˆæ”¾åœ¨Readmeä¸­ï¼Œä½†æ€»ä¹‹ï¼Œä»¥ä¸‹æ˜¯ä¸€äº›å¯ä»¥è€ƒè™‘çš„ç‚¹ã€‚\u003c/p\u003e\n\u003ch3 id=\"ç³»ç»Ÿè®¾è®¡æ–‡æ¡£\"\u003eç³»ç»Ÿè®¾è®¡æ–‡æ¡£\u003c/h3\u003e\n\u003cp\u003eè¿™é‡Œçš„è®¾è®¡æŒ‡çš„æ˜¯ç³»ç»Ÿçš„æ¶æ„ï¼Œå°¤å…¶è¦å…³æ³¨\u003cstrong\u003eç³»ç»Ÿä¹‹é—´æ˜¯å¦‚ä½•è¿æ¥çš„\u003c/strong\u003eã€‚\u003c/p\u003e\n\u003cp\u003eè€Œä»¥ä¸‹å†…å®¹ä¸åº”è¯¥è¢«åŒ…å«åœ¨å…¶ä¸­ï¼š\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eæœåŠ¡çš„å…·ä½“ç»†èŠ‚ã€‚\u003c/li\u003e\n\u003cli\u003eç»„ä»¶çš„è®¾è®¡æ¨¡å¼ã€‚\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch3 id=\"ç»„ä»¶æ–‡æ¡£\"\u003eç»„ä»¶æ–‡æ¡£\u003c/h3\u003e\n\u003cp\u003eæ•´ç†æ‰€æœ‰çš„ç»„ä»¶/æœåŠ¡ï¼Œå¯ä»¥æœ‰ä»¥ä¸‹å…³æ³¨ç‚¹ï¼š\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eä»‹ç»\u003c/li\u003e\n\u003cli\u003eæœåŠ¡ç±»å‹ï¼ˆæ¯”å¦‚SSR /Staticï¼‰\u003c/li\u003e\n\u003cli\u003eè·¯ç”±å‰ç¼€\u003c/li\u003e\n\u003cli\u003eç”Ÿäº§ç¯å¢ƒåŸŸå\u003c/li\u003e\n\u003cli\u003eé¢„å‘ç¯å¢ƒåŸŸå\u003c/li\u003e\n\u003cli\u003eæµ‹è¯•ç¯å¢ƒåŸŸåï¼ˆè§„åˆ™ï¼‰\u003c/li\u003e\n\u003cli\u003eä»“åº“åœ°å€\u003c/li\u003e\n\u003cli\u003eæµæ°´çº¿åœ°å€\u003c/li\u003e\n\u003cli\u003eå‘å¸ƒåˆ†æ”¯\u003c/li\u003e\n\u003cli\u003eæ¶‰åŠæŠ€æœ¯æ ˆ\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch3 id=\"å¼€å‘è€…faq\"\u003eå¼€å‘è€…FAQ\u003c/h3\u003e\n\u003cp\u003eç›®çš„æ˜¯æ”¶é›†å¼€å‘è€…å…³å¿ƒçš„å¸¸è§é—®é¢˜ï¼Œæ¯”å¦‚é¡¹ç›®å¦‚ä½•æœ¬åœ°å¯åŠ¨ï¼Œå¿…è¦æƒé™å¦‚ä½•ç”³è¯·ç­‰ã€‚\u003c/p\u003e\n\u003ch3 id=\"å¼€å‘è€…éªŒè¯æŒ‡å—\"\u003eå¼€å‘è€…éªŒè¯æŒ‡å—\u003c/h3\u003e\n\u003cp\u003eç›®çš„æ˜¯ä¿è¯å¼€å‘è€…æäº¤çš„ç»„ä»¶å¯ä»¥åœ¨ç”Ÿäº§ç¯å¢ƒä¸­è¿è¡Œï¼Œè€Œä¸æ˜¯å®Œå…¨ä¾èµ–QAã€‚å¸¸è§çš„æ‰‹æ®µæœ‰æµ‹è¯•ç”¨ä¾‹ï¼Œcode reviewç­‰ï¼Œä¸”å¾ˆå¯èƒ½ä¸CI/CDæµç¨‹æœ‰å…³ã€‚ä¸ªäººè§‰å¾—å¼€å‘è€…å¾ˆå®¹æ˜“å¯¹ä¸€äº›å°æ”¹åŠ¨æœ‰è¿·ä¹‹è‡ªä¿¡ï¼Œç»“æœå´æäº¤æ— æ³•åœ¨æµ‹è¯•ç¯å¢ƒè¿è¡Œçš„ä»£ç ç”šè‡³æå´©çº¿ä¸Šã€‚è¯¥æ­¥éª¤éå¸¸é‡è¦åˆå®¹æ˜“è¢«å¿½è§†ã€‚\u003c/p\u003e\n\u003ch2 id=\"awsæœåŠ¡\"\u003eAWSæœåŠ¡\u003c/h2\u003e\n\u003cp\u003eawsæœåŠ¡å¤ªå¸¸è§äº†ï¼Œç¨å¾®è®°å½•ä¸€ä¸‹æˆ‘æœ¬æ¬¡æ¥è§¦çš„ï¼Œä¸è‡³äºä¸€äº›åè¯éƒ½æ²¡æœ‰æ¦‚å¿µã€‚\u003c/p\u003e\n\u003ch3 id=\"ecs\"\u003eECS\u003c/h3\u003e\n\u003cp\u003eECS is Amazon Elastic \u003cstrong\u003eContainer Service\u003c/strong\u003e.\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eContainer Orchestration Service (å®¹å™¨ç¼–æ’å·¥å…·ï¼‰\u003c/li\u003e\n\u003cli\u003eManages the whole container lifecycle.\n\u003cul\u003e\n\u003cli\u003estart\u003c/li\u003e\n\u003cli\u003ere-schedule\u003c/li\u003e\n\u003cli\u003eload balance\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003eECS Clusterï¼ˆECSé›†ç¾¤ï¼‰æ˜¯Control Planeï¼Œç®¡ç†æ‰€æœ‰è¿è¡Œç€å®¹å™¨çš„è™šæ‹Ÿæœºå™¨ã€‚\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e\u003cimg src=\"https://s2.loli.net/2023/01/09/u8ytTRfvmx7gk4n.jpg\" alt=\"How does ECS work\"\u003e\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eè€Œè¿™äº›è™šæ‹Ÿæœºæ˜¯ä»€ä¹ˆï¼Ÿæ˜¯EC2 Instanceï¼Œä½ è¿˜æ˜¯éœ€è¦ç®¡ç†è¿™äº›Instanceçš„ï¼Œæ¯”å¦‚åœ¨å¢åŠ containerçš„æ—¶å€™ï¼Œéœ€è¦ç¡®ä¿Instanceçš„èµ„æºè¶³å¤Ÿã€‚\u003c/li\u003e\n\u003cli\u003eä½†å¦‚æœæˆ‘ä»¬æƒ³åœ¨AWSä¸Šhosting infrastructureã€‚å¯ä»¥ç”¨AWS Fargateã€‚é‚£å°±ä¸éœ€è¦æ‰‹åŠ¨ç®¡ç†Instanceï¼Œä»–ä¼šæ ¹æ®ä½ æƒ³è¦è¿è¡Œçš„containeræ¥è‡ªåŠ¨åˆ†é…èµ„æºã€‚èŠ‚çœå‘€ï¼\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch3 id=\"eks\"\u003eEKS\u003c/h3\u003e\n\u003cp\u003eEKS is Elastic \u003cstrong\u003eKubernetes\u003c/strong\u003e Service.\u003c/p\u003e\n\u003cp\u003eKubernetes æ˜¯ECSçš„ç«å“ï¼Œéå¸¸Popularï¼Œæ‰€ä»¥EKSå°±æ˜¯ä¸ºäº†åœ¨AWSä½¿ç”¨Kubernetesæ¨å‡ºçš„ã€‚\u003c/p\u003e\n\u003cp\u003eEKSçš„å·¥ä½œæ–¹å¼å’ŒECSå·®ä¸å¤šã€‚\u003c/p\u003e\n\u003ch3 id=\"ecr\"\u003eECR\u003c/h3\u003e\n\u003cp\u003eECR is Elastic \u003cstrong\u003eContainer Registry\u003c/strong\u003e, a private docker registry.\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://s2.loli.net/2023/01/09/Lw6m7geKZ9A4YSW.png\" alt=\"whole story, Jenkins involved here!\"\u003e\u003c/p\u003e\n\u003ch3 id=\"elb\"\u003eELB\u003c/h3\u003e\n\u003cp\u003eELB is Elastic load balancing service.\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://s2.loli.net/2023/01/09/EaFjZvJ731LDGRA.png\" alt=\"è´Ÿè½½å‡è¡¡æœåŠ¡\"\u003e\u003c/p\u003e\n\u003cp\u003eä½¿ç”¨è¿™æ ·ä¸€ä¸ª load balanceræœ‰å¾ˆå¤šå¥½å¤„\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eå°†æµé‡åˆ†é…ç»™äº†å¾ˆå¤šä¸‹çº§å®ä¾‹\u003c/li\u003e\n\u003cli\u003eåªæš´éœ²å‡ºä¸€ä¸ªå…¥å£ï¼ˆDNSï¼‰\u003c/li\u003e\n\u003cli\u003eæ— ç¼å¤„ç†ä¸‹çº§åº”ç”¨çš„failures\u003c/li\u003e\n\u003cli\u003eå¯¹å®ä¾‹è¿›è¡Œå¥åº·æ£€æŸ¥\u003c/li\u003e\n\u003cli\u003eæä¾›https\u003c/li\u003e\n\u003cli\u003eå¼ºåˆ¶ä½¿ç”¨cookiesï¼Œæ‰€ä»¥ç”¨æˆ·å¯ä»¥è®¿é—®åˆ°åŒä¸€ä¸ªinstance\u003c/li\u003e\n\u003cli\u003eâ€¦\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch3 id=\"aws-lambda\"\u003eAWS lambda\u003c/h3\u003e\n\u003cp\u003eè¿™æ˜¯ä¸€ä¸ªServerlessæœåŠ¡ï¼ŒåŸºæœ¬ä¸Šå¯ä»¥ç†è§£ä¸ºå®ƒæä¾›äº†æ ¹æ®äº‹ä»¶è‡ªåŠ¨è§¦å‘Functionçš„èƒ½åŠ›ã€‚\u003c/p\u003e\n\u003cp\u003eå…¶ä¸­äº‹ä»¶å¯ä»¥æŒ‡çš„æ˜¯S3çš„å†…å®¹å˜åŒ–ï¼ŒAPIçš„è¯·æ±‚ï¼Œæˆ–å…¶ä»–å„ç§å„æ ·çš„AWSæœåŠ¡äº‹ä»¶ã€‚\u003c/p\u003e\n\u003cp\u003eè¿™é‡Œæ¶‰åŠåˆ°ä¸€ä¸ªæ¦‚å¿µï¼ŒServerlessï¼Œå€¼å¾—è¯´ä¸€è¯´ã€‚\u003c/p\u003e\n\u003cp\u003eæˆ‘ä¸ªäººçš„ç†è§£æ˜¯è¿™æ ·çš„ï¼š\u003c/p\u003e\n\u003cp\u003eé¦–å…ˆServerlesså¹¶ä¸æ˜¯è¯´æ²¡æœ‰Serverï¼Œè€Œæ˜¯Serverå¯¹ç”¨æˆ·ä¸å¯è§ï¼Œwhich meansï¼š\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eä¸éœ€è¦æ‰‹åŠ¨ç®¡ç†serverã€‚\u003c/li\u003e\n\u003cli\u003eä¼šæ ¹æ®ä½¿ç”¨è‡ªåŠ¨æ‰©å®¹ã€‚\u003c/li\u003e\n\u003cli\u003eåªæœ‰å½“è¢«ä½¿ç”¨çš„æ—¶å€™ï¼Œæ‰ä¼šäº§ç”Ÿè´¹ç”¨ï¼ˆè€Œä¸æ˜¯ä¸ºServeræœ¬èº«ä»˜è´¹ï¼‰ã€‚\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e\u003cimg src=\"https://s2.loli.net/2023/01/09/B2oTW3lrEuznZGK.png\" alt=\"\"\u003e\u003c/p\u003e\n\u003ch2 id=\"ç¯å¢ƒå˜é‡\"\u003eç¯å¢ƒå˜é‡\u003c/h2\u003e\n\u003ch3 id=\"ç¯å¢ƒå˜é‡-in-nextjs\"\u003eç¯å¢ƒå˜é‡ in Next.js\u003c/h3\u003e\n\u003cp\u003eBefore \u003ccode\u003econst HOST_NAME = 'www.sample.com'\u003c/code\u003e.\u003c/p\u003e\n\u003cp\u003eAfter \u003ccode\u003econst HOST_NAME = 'process.env.NEXT_PUBLIC_HOST_NAME'\u003c/code\u003e.\u003c/p\u003e\n\u003cp\u003eè¿™é‡Œæ¶‰åŠåˆ°Next.jsçš„ä¸€ä¸ªç‰¹æ€§ï¼š\u003ca href=\"https://nextjs.org/docs/basic-features/environment-variables#exposing-environment-variables-to-the-browser\" target=\"_blank\" rel=\"nofollow\"\u003eexpose env vars to the browser\u003c/a\u003eã€‚\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eDuring the \u003cstrong\u003ebuild stage\u003c/strong\u003e, next.js will find these env vars start with \u003cstrong\u003eNEXT_PUBLIC_\u003c/strong\u003e and replace them with literal.\u003c/li\u003e\n\u003cli\u003ebuild stageå¾ˆå…³é”®ï¼Œåœ¨CI/CDæµç¨‹ä¸­ï¼Œå¯èƒ½æœ‰buildã€releaseç­‰å¤šä¸ªç¯èŠ‚ï¼Œåœ¨å“ªé‡Œä¼ å…¥ç¯å¢ƒå˜é‡å¾ˆå…³é”®ã€‚\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e\u003cstrong\u003eTrick: å¦‚æœåœ¨ä¸€äº›æƒ…å½¢ä¸‹ï¼Œæˆ‘ä»¬éœ€è¦æŠŠç”¨äºnodeç«¯çš„ç¯å¢ƒå˜é‡æš´éœ²ç»™æµè§ˆå™¨ï¼Œå¯ä»¥æ€ä¹ˆåšï¼Ÿ\u003c/strong\u003e\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eRead these env vars inside \u003ccode\u003egetServerSideProps\u003c/code\u003e and return them as props. \u003ca href=\"https://nextjs.org/docs/basic-features/data-fetching/get-server-side-props#when-does-getserversideprops-run\" target=\"_blank\" rel=\"nofollow\"\u003eMore to read about it\u003c/a\u003e.\u003c/li\u003e\n\u003c/ul\u003e\n\u003cpre class=\"language-javascript\"\u003e\u003ccode class=\"language-javascript\"\u003e  \u003cspan class=\"token keyword module\"\u003eexport\u003c/span\u003e \u003cspan class=\"token keyword\"\u003econst\u003c/span\u003e \u003cspan class=\"token function-variable function\"\u003egetServerSideProps\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token arrow operator\"\u003e=\u003e\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"token comment\"\u003e// we can read server side env vars here.\u003c/span\u003e\n    \u003cspan class=\"token keyword control-flow\"\u003ereturn\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n      \u003cspan class=\"token literal-property property\"\u003eserverConstants\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"token constant\"\u003eTEST_HOST_NAME\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e process\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token property-access\"\u003eenv\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token constant\"\u003eTEST_HOST_NAME\u003c/span\u003e\n      \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n  \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n  \n  \u003cspan class=\"token comment\"\u003e// client side.\u003c/span\u003e\n  \u003cspan class=\"token keyword module\"\u003eexport\u003c/span\u003e \u003cspan class=\"token keyword\"\u003econst\u003c/span\u003e \u003cspan class=\"token function-variable function\"\u003e\u003cspan class=\"token maybe-class-name\"\u003ePage\u003c/span\u003e\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token parameter\"\u003eprops\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token arrow operator\"\u003e=\u003e\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"token keyword\"\u003econst\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e serverConstants \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e props\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"token keyword control-flow\"\u003ereturn\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\n      \u003cspan class=\"token operator\"\u003e\u0026#x3C;\u003c/span\u003ep\u003cspan class=\"token operator\"\u003e\u003e\u003c/span\u003e\u003cspan class=\"token constant\"\u003eTEST_HOST_NAME\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003eserverConstants\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token constant\"\u003eTEST_HOST_NAME\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token operator\"\u003e\u0026#x3C;\u003c/span\u003e\u003cspan class=\"token operator\"\u003e/\u003c/span\u003ep\u003cspan class=\"token operator\"\u003e\u003e\u003c/span\u003e\n    \u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n  \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch3 id=\"æœ¬åœ°ç¯å¢ƒå˜é‡\"\u003eæœ¬åœ°ç¯å¢ƒå˜é‡\u003c/h3\u003e\n\u003cp\u003eå…³äºåœ¨æœ¬åœ°å¼€å‘ä¸­ä½¿ç”¨ç¯å¢ƒå˜é‡ï¼Œnext.js å·²ç»æœ‰äº†å¾ˆå¥½çš„æ”¯æŒï¼ŒæŸ¥çœ‹ \u003ca href=\"https://nextjs.org/docs/basic-features/environment-variables#loading-environment-variables\" target=\"_blank\" rel=\"nofollow\"\u003eè¿™é‡Œ\u003c/a\u003eã€‚\u003c/p\u003e\n\u003cp\u003eåœ¨å®é™…åœºæ™¯ä¸‹ï¼Œå¯ä»¥åˆ›å»ºä¸€ä¸ª.env.local.examlpeæ–‡ä»¶ã€‚\u003c/p\u003e\n\u003cp\u003eå¼€å‘è€…å¯ä»¥æ‹·è´è¯¥æ–‡ä»¶å¹¶å°†å…¶ä½œä¸ºè‡ªå·±çš„.env.localæ–‡ä»¶ã€‚\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003e.env.local ä¸åº”è¯¥è¢«æäº¤åˆ°repoä¸­ï¼\u003c/strong\u003e\u003c/p\u003e\n\u003ch3 id=\"ç¯å¢ƒå˜é‡-in-jest\"\u003eç¯å¢ƒå˜é‡ in Jest\u003c/h3\u003e\n\u003cp\u003eæ–¹æ³•æ˜¯æœ‰å¾ˆå¤šçš„ï¼ŒæŒ‰éœ€é‡‡ç”¨ï¼Œè¿™é‡Œè®°å½•ä¸¤ç§ã€‚\u003c/p\u003e\n\u003ch3 id=\"åœ¨jestçš„setupæ–‡ä»¶ä¸­è®¾ç½®ç¯å¢ƒå˜é‡\"\u003eåœ¨jestçš„setupæ–‡ä»¶ä¸­è®¾ç½®ç¯å¢ƒå˜é‡\u003c/h3\u003e\n\u003cp\u003e\u003ca href=\"https://jestjs.io/docs/configuration#setupfilesafterenv-array\" target=\"_blank\" rel=\"nofollow\"\u003eæ–‡æ¡£åœ¨æ­¤\u003c/a\u003eã€‚ç®€å•æ¥è¯´ï¼Œåœ¨è¿™é‡Œè®¾ç½®çš„ç¯å¢ƒå˜é‡ä¼šä½œç”¨äºæ¯ä¸ªæµ‹è¯•ç”¨ä¾‹æ–‡ä»¶ã€‚\u003c/p\u003e\n\u003cp\u003eé€‚åˆç”¨äºè®¾ç½®é»˜è®¤ç¯å¢ƒå˜é‡ï¼Œä½†æ— æ³•æ»¡è¶³éœ€è¦æµ‹è¯•ä¸åŒçš„ç¯å¢ƒå˜é‡çš„åœºæ™¯ã€‚\u003c/p\u003e\n\u003ch3 id=\"åœ¨æµ‹è¯•ç”¨ä¾‹æ–‡ä»¶ä¸­è®¾ç½®ç¯å¢ƒå˜é‡\"\u003eåœ¨æµ‹è¯•ç”¨ä¾‹æ–‡ä»¶ä¸­è®¾ç½®ç¯å¢ƒå˜é‡\u003c/h3\u003e\n\u003cp\u003eå½“ç„¶æˆ‘ä»¬å¯ä»¥åœ¨æµ‹è¯•ç”¨ä¾‹æ–‡ä»¶ä¸­è®¾ç½®ç¯å¢ƒå˜é‡ã€‚\u003c/p\u003e\n\u003cp\u003eåªæ˜¯è¦è®°ä½ï¼Œåœ¨æ¯ä¸ªæµ‹è¯•ç”¨ä¾‹å‰ï¼Œä¸€å®šè¦ä½¿ç”¨ \u003ca href=\"https://jestjs.io/docs/jest-object#jestresetmodules\" target=\"_blank\" rel=\"nofollow\"\u003e\u003cstrong\u003erestModules\u003c/strong\u003e\u003c/a\u003e ï¼Œä¸”\u003cstrong\u003eåŠ¨æ€å¼•å…¥\u003c/strong\u003eæ¶‰åŠç¯å¢ƒå˜é‡çš„æ¨¡å—ã€‚\u003c/p\u003e\n\u003cpre class=\"language-javascript\"\u003e\u003ccode class=\"language-javascript\"\u003e\u003cspan class=\"token function\"\u003edescribe\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e'environmental variables'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token arrow operator\"\u003e=\u003e\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"token keyword\"\u003econst\u003c/span\u003e \u003cspan class=\"token constant\"\u003eOLD_ENV\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e process\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token property-access\"\u003eenv\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\n  \u003cspan class=\"token function\"\u003ebeforeEach\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token arrow operator\"\u003e=\u003e\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n    jest\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token method function property-access\"\u003eresetModules\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token comment\"\u003e// Most important - it clears the cache\u003c/span\u003e\n    process\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token property-access\"\u003eenv\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e \u003cspan class=\"token spread operator\"\u003e...\u003c/span\u003e\u003cspan class=\"token constant\"\u003eOLD_ENV\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e \u003cspan class=\"token comment\"\u003e// Make a copy\u003c/span\u003e\n  \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\n  \u003cspan class=\"token function\"\u003eafterAll\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token arrow operator\"\u003e=\u003e\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n    process\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token property-access\"\u003eenv\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token constant\"\u003eOLD_ENV\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e \u003cspan class=\"token comment\"\u003e// Restore old environment\u003c/span\u003e\n  \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\n  \u003cspan class=\"token function\"\u003etest\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e'will receive process.env variables'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token arrow operator\"\u003e=\u003e\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"token comment\"\u003e// Set the variables\u003c/span\u003e\n    process\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token property-access\"\u003eenv\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token constant\"\u003eNODE_ENV\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token string\"\u003e'dev'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n    process\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token property-access\"\u003eenv\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token constant\"\u003ePROXY_PREFIX\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token string\"\u003e'/new-prefix/'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n    process\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token property-access\"\u003eenv\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token constant\"\u003eAPI_URL\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token string\"\u003e'https://new-api.com/'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n    process\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token property-access\"\u003eenv\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token constant\"\u003eAPP_PORT\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token string\"\u003e'7080'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n    process\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token property-access\"\u003eenv\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token constant\"\u003eUSE_PROXY\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token string\"\u003e'false'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\n    \u003cspan class=\"token keyword\"\u003econst\u003c/span\u003e testedModule \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token function\"\u003erequire\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e'../../config/env'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token keyword module\"\u003edefault\u003c/span\u003e \u003cspan class=\"token comment\"\u003e// dynamic import\u003c/span\u003e\n\n    \u003cspan class=\"token comment\"\u003e// ... actual testing\u003c/span\u003e\n  \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch2 id=\"å…¶ä»–\"\u003eå…¶ä»–\u003c/h2\u003e\n\u003ch3 id=\"æœ¬åœ°ä¸€åˆ‡å®‰å¥½çº¿ä¸Šå‘å¸ƒç¼ºå°‘ä¾èµ–å¯èƒ½æ˜¯\"\u003eæœ¬åœ°ä¸€åˆ‡å®‰å¥½ï¼Œçº¿ä¸Šå‘å¸ƒç¼ºå°‘ä¾èµ–ï¼Œå¯èƒ½æ˜¯ï¼Ÿ\u003c/h3\u003e\n\u003cp\u003eè§„åˆ™ï¼šå¦‚æœ\u003ccode\u003eNODE_ENV\u003c/code\u003eè¢«è®¾ç½®æˆ\u003ccode\u003eproduction\u003c/code\u003eï¼Œyarnä¸ä¼šå®‰è£…\u003ccode\u003edevDependencies\u003c/code\u003eä¸­çš„ä¾èµ–ï¼Œå…·ä½“å¯çœ‹\u003ca href=\"https://classic.yarnpkg.com/en/docs/cli/install#toc-yarn-install-production-true-false\" target=\"_blank\" rel=\"nofollow\"\u003eè¿™é‡Œ\u003c/a\u003eã€‚\u003c/p\u003e\n\u003cp\u003eæ‰€ä»¥è¿™ç§cmdæ˜¯åˆç†çš„ï¼š\u003ccode\u003eyarn install \u0026#x26;\u0026#x26; yarn test \u0026#x26;\u0026#x26; NODE_ENV=production yarn export\u003c/code\u003eã€‚\u003c/p\u003e\n\u003cp\u003eç›¸å¯¹çš„ï¼Œå¦‚æœ\u003ccode\u003eNODE_ENV\u003c/code\u003eè¢«è®¾ç½®çš„å¤ªæ—©ï¼Œå¾ˆå¯èƒ½ä¼šå¯¼è‡´\u003ccode\u003eyarn test\u003c/code\u003eç¼ºå°‘ä¾èµ–ã€‚\u003c/p\u003e\n\u003ch3 id=\"å¦‚ä½•æ›´æ–°åŒ…ç»„ä»¶æœåŠ¡\"\u003eå¦‚ä½•æ›´æ–°åŒ…/ç»„ä»¶/æœåŠ¡\u003c/h3\u003e\n\u003cp\u003eé™¤äº†æ›´æ–°é€»è¾‘ï¼Œä¸€èˆ¬è¿˜æœ‰å“ªäº›æ­¥éª¤ï¼Ÿ\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003eæ›´æ–°æµ‹è¯•ç”¨ä¾‹ï¼Œä¿è¯æœ¬åœ°æµ‹è¯•ç”¨ä¾‹é€šè¿‡ã€‚\u003c/li\u003e\n\u003cli\u003eæœ¬åœ°æˆåŠŸè¿è¡ŒæœåŠ¡ã€‚\u003c/li\u003e\n\u003cli\u003eå¼€ä¸€ä¸ªdraft PR.\n\u003col\u003e\n\u003cli\u003eå°†å…¶éƒ¨ç½²åˆ°æµ‹è¯•ç¯å¢ƒã€‚\u003c/li\u003e\n\u003cli\u003eåœ¨æµ‹è¯•ç¯å¢ƒæˆåŠŸè¿è¡Œã€‚\u003c/li\u003e\n\u003c/ol\u003e\n\u003c/li\u003e\n\u003cli\u003eæ›´æ–°ç‰ˆæœ¬ã€‚ï¼ˆè§†å…·ä½“æƒ…å½¢ï¼‰\u003c/li\u003e\n\u003cli\u003eæ‰¾äººreviewã€‚\u003c/li\u003e\n\u003cli\u003eæœ‰äº†approvalsï¼Œå¯ä»¥mergeã€‚\u003c/li\u003e\n\u003cli\u003eå…¶ä½™çš„å°±æ˜¯QAã€éƒ¨ç½²æµç¨‹ç­‰ã€‚\u003c/li\u003e\n\u003c/ol\u003e\n\u003ch3 id=\"jwt\"\u003eJWT\u003c/h3\u003e\n\u003cp\u003eJWTï¼ˆJSON web tokenï¼‰æ˜¯ä¸€ç§å¸¸è§çš„åœ¨å®¢æˆ·ç«¯ä¸æœåŠ¡ç«¯é—´ä¼ é€’ä¿¡æ¯çš„æ–¹å¼ã€‚\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003eé™¤éçŸ¥é“ç­¾åï¼Œç”¨æˆ·æ˜¯æ— æ³•ä¼ªé€ æ•°æ®çš„ã€‚\u003c/li\u003e\n\u003cli\u003eè€Œheaderå’Œpayloadæœ¬èº«æ˜¯å¹¶æ²¡æœ‰è¢«åŠ å¯†çš„ã€‚\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003eæ‰€ä»¥åœ¨å®é™…åº”ç”¨åœºæ™¯ä¸­ï¼Œä»»ä½•äººéƒ½å¯ä»¥æŸ¥çœ‹è¯·æ±‚çš„æ•°æ®ï¼Œä½†ä¸çŸ¥é“ç­¾åçš„æ™®é€šç”¨æˆ·æ²¡åŠæ³•è‡ªå·±æ„é€ ã€ç¯¡æ”¹è¯·æ±‚ã€‚\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"https://en.wikipedia.org/wiki/JSON_Web_Token\" target=\"_blank\" rel=\"nofollow\"\u003eè¿›ä¸€æ­¥äº†è§£JWT\u003c/a\u003eã€‚\u003c/p\u003e\n\u003ch3 id=\"yarn2\"\u003eYarn2\u003c/h3\u003e\n\u003cp\u003eYarn2 = \u003cstrong\u003eyarn berry\u003c/strong\u003eï¼ˆæ›´åŠ å‡†ç¡®ï¼‰ã€‚å’Œ yarn 1.x æ¯”èµ·æ¥ç®—æ˜¯å¤§æ”¹ã€‚\u003c/p\u003e\n\u003cp\u003eå¦‚æœä½¿ç”¨PnPç‰¹æ€§ï¼Œyarnä¼šç”Ÿæˆ\u003ccode\u003e.pnp.cjs\u003c/code\u003eä»¥ä»£æ›¿\u003ccode\u003enode_modules\u003c/code\u003eã€‚\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003e.pnp.cjs\u003c/code\u003eåªæ˜¯ä¸€äº›mapsï¼ŒåŒ…æ‹¬å¦‚ä½•åœ¨æ–‡ä»¶ç³»ç»Ÿä¸­æ‰¾åˆ°packagesã€‚\u003c/p\u003e\n\u003cp\u003eè€Œpackagesæœ¬èº«ï¼Œæ˜¯è¢«zippedå‹ç¼©è¿‡çš„ï¼Œæ‰€ä»¥æ–‡ä»¶çš„æ•°é‡è¿œè¿œå°‘äº\u003ccode\u003enode_modules\u003c/code\u003eã€‚\u003c/p\u003e\n\u003cp\u003eå°½ç®¡packageè¢«å‹ç¼©è¿‡ï¼Œæˆ‘ä»¬ä»ç„¶å¯ä»¥å€ŸåŠ©\u003ccode\u003efs\u003c/code\u003eçš„èƒ½åŠ›è¯»å–æ–‡ä»¶ã€‚\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eæ›´å¤šyarn2ï¼Œæ¬¢è¿é˜…è¯»ï¼š\u003c/strong\u003e\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"https://blog.logrocket.com/javascript-package-managers-compared/\" target=\"_blank\" rel=\"nofollow\"\u003eJavaScript package managers compared: npm, Yarn, or pnpm?\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://www.yarnpkg.cn/features/pnp\" target=\"_blank\" rel=\"nofollow\"\u003ePlug'n'Play\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch3 id=\"çº¿ä¸Šç›‘æ§æœåŠ¡å¼‚å¸¸æ’æŸ¥\"\u003eçº¿ä¸Šç›‘æ§æœåŠ¡å¼‚å¸¸æ’æŸ¥\u003c/h3\u003e\n\u003cp\u003eå¦‚æœæ€€ç–‘æœ‰å¼‚å¸¸çš„çº¿ä¸Šæµé‡ï¼Œå¦‚ä½•æ’æŸ¥ï¼š\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003eè°ƒæ•´æ—¶é—´åŒºé—´ï¼Œæ¥è§‚å¯Ÿæµé‡æ˜¯å¦æ˜¯ä¸€ç¬é—´æ¶Œå…¥çš„ã€‚\u003c/li\u003e\n\u003cli\u003eæ¯”è¾ƒæœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯çš„æµé‡ï¼Œè§‚å¯Ÿæµé‡æ˜¯å¦æ˜¯ç›´æ¥æ‰“åˆ°æœåŠ¡ç«¯çš„ã€‚\u003c/li\u003e\n\u003cli\u003eæ¯”è¾ƒæµé‡å³°å€¼æ—¥å¿—æ˜¯å¦æœ‰å…±åŒç‚¹ï¼šClient IP, Country, Region, Cityâ€¦\u003c/li\u003e\n\u003c/ol\u003e\n\u003c/body\u003e\u003c/html\u003e","description":"æœ€è¿‘ç»“æŸçš„ä¸€ä¸ªé¡¹ç›®æœ‰å¾ˆå¤šå€¼å¾—å­¦ä¹ çš„åœ°æ–¹ï¼ŒæŒ‘ä¸€äº›ä¸æ•æ„Ÿçš„åœ¨æ­¤è®°å½•ã€‚å…¶ä¸­çš„æ¯ä¸€ç‚¹å…¶å®éƒ½æœ‰æ·±å…¥æŒ–æ˜çš„ç©ºé—´ï¼Œæ—¥åæƒ³å¿…ä¼šå†æ¬¡é‡åˆ°ã€‚......"},"__N_SSG":true},"page":"/posts/[id]","query":{"id":"R-project-summary"},"buildId":"L_CyqIx4aqZcAL1u9DngY","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>