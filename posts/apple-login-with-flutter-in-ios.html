<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width"/><title>LWDW!</title><meta name="description" content="Sign in with apple by Flutter in iOS"/><meta property="og:title" content="Sign in with apple by Flutter in iOS"/><meta property="og:description" content="Sign in with Apple is commonly used by modern apps now, this article will introduce a way to impleme......"/><meta name="next-head-count" content="6"/><link rel="apple-touch-icon" sizes="180x180" href="/favicon/apple-touch-icon.png"/><link rel="icon" type="image/png" sizes="32x32" href="/favicon/favicon-32x32.png"/><link rel="icon" type="image/png" sizes="16x16" href="/favicon/favicon-16x16.png"/><link rel="manifest" href="/favicon/site.webmanifest"/><link rel="mask-icon" href="/favicon/safari-pinned-tab.svg" color="#ffffff"/><meta name="msapplication-TileColor" content="#ffffff"/><meta name="theme-color" content="#000"/><meta property="og:type" content="website"/><meta property="og:image" content="https://s2.loli.net/2023/01/18/42YTZxzePtR7jy9.png"/><meta property="og:url" content="https://b-sirius.github.io"/><link rel="preload" href="/_next/static/css/aef510c8abf24c2c.css" as="style"/><link rel="stylesheet" href="/_next/static/css/aef510c8abf24c2c.css" data-n-g=""/><link rel="preload" href="/_next/static/css/b51a0fb142b75fa0.css" as="style"/><link rel="stylesheet" href="/_next/static/css/b51a0fb142b75fa0.css" data-n-p=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-c67a75d1b6f99dc8.js"></script><script src="/_next/static/chunks/webpack-f164db4954bac6ec.js" defer=""></script><script src="/_next/static/chunks/framework-114634acb84f8baa.js" defer=""></script><script src="/_next/static/chunks/main-673a4fae4a27af6a.js" defer=""></script><script src="/_next/static/chunks/pages/_app-0da236044dc4e5fc.js" defer=""></script><script src="/_next/static/chunks/664-1b4479b4462ded63.js" defer=""></script><script src="/_next/static/chunks/332-e879213584d084bf.js" defer=""></script><script src="/_next/static/chunks/pages/posts/%5Bid%5D-1001914fc6870d3d.js" defer=""></script><script src="/_next/static/u9-Sh7cpFEfudU57A_VSr/_buildManifest.js" defer=""></script><script src="/_next/static/u9-Sh7cpFEfudU57A_VSr/_ssgManifest.js" defer=""></script></head><body><div id="__next"><div class="sc-b711fa3b-0 dxGMRG"><div class="sc-7fa12c98-0 iqAzDm"><div class="sc-357ac6e1-1 blSmbb"><div class="sc-357ac6e1-0 fqUBXX"><a class="sc-357ac6e1-2 gfNIvm" href="/">[<!-- -->Home<!-- -->]</a><a class="sc-357ac6e1-2 gfNIvm" href="/posts">[<!-- -->Posts<!-- -->]</a><a class="sc-357ac6e1-3 eNeEmH" rel="noopener noreferrer" target="_blank" href="https://github.com/B-sirius">[<!-- -->Github<!-- -->]</a><a class="sc-357ac6e1-3 eNeEmH" rel="noopener noreferrer" target="_blank" href="https://b-sirius.github.io/rss.xml">[<!-- -->RSS<!-- -->]</a></div><div class="sc-f5ce872-0 drvesR"><h1 class="sc-f5ce872-1 jPBPjm">LWDW!</h1><p class="sc-f5ce872-2 djaGsH">Learn the work from doing the worküç∫</p></div></div><div class="sc-920e94b6-0 sc-20291786-0 cMfBpD eCERES"><div><div class="sc-32c5999b-0 iFBmZi"><div class="sc-32c5999b-2 fHkOeB">Sign in with apple by Flutter in iOS</div><div class="sc-32c5999b-3 deKveP">Posted on <!-- -->2023-03-02</div></div></div></div><div class="sc-920e94b6-0 cMfBpD"><div><div class="sc-32c5999b-1 fNXLto"><div class="sc-29ea8e37-0 bjoUyc"><div><html><head></head><body><p>Sign in with Apple is commonly used by modern apps now, this article will introduce a way to implement it with Flutter for iOS apps.</p>
<ul>
<li><a href="#intro">Intro</a>
<ul>
<li><a href="#flow">Flow</a></li>
<li><a href="#used-packages">Used Packages</a></li>
<li><a href="#docs">Docs</a></li>
</ul>
</li>
<li><a href="#steps">Steps</a>
<ul>
<li><a href="#1-settings-on-the-apple-developer-page">1. Settings on the Apple Developer page</a>
<ul>
<li><a href="#editcreate-identifier">edit/create Identifier</a></li>
<li><a href="#create-private-key">create private key</a></li>
</ul>
</li>
<li><a href="#2-settings-in-xcode">2. Settings in Xcode</a></li>
<li><a href="#3-logic-in-the-client-side">3. Logic in the Client side</a></li>
<li><a href="#4-logic-in-the-app-service-side">4. Logic in the App Service side</a>
<ul>
<li><a href="#create-client-secret">create client secret</a></li>
</ul>
</li>
<li><a href="#get-authorization-token">get authorization token</a></li>
</ul>
</li>
<li><a href="#conclusion">Conclusion</a></li>
</ul>
<h2 id="intro">Intro</h2>
<p>Here I will introduce the Apple login flow in iOS, which is <strong>based on the authorization code.</strong></p>
<p>There should be another way to use the identity token and Apple public key to do the same job, but we didn‚Äôt put it into practice, so for now I won‚Äôt cover it.</p>
<h3 id="flow">Flow</h3>
<p>The iOS apple login flow is not bounded with flutter tech (Apple login in Android or Web has more steps than this and is not introduced here).</p>
<p><img src="https://s2.loli.net/2023/03/02/IhVbdx2l3JFeP56.png" alt="apple login in iOS"></p>
<h3 id="used-packages">Used Packages</h3>
<ul>
<li>Flutter
<ul>
<li><a href="https://pub.dev/packages/sign_in_with_apple" target="_blank" rel="nofollow">sign_in_with_apple</a>. Flutter bridge to Sign in with Apple.</li>
</ul>
</li>
<li>Node
<ul>
<li><a href="https://www.npmjs.com/package/apple-signin-auth" target="_blank" rel="nofollow">apple-signin-auth</a>. Apple sign in for Node.js.</li>
</ul>
</li>
</ul>
<h3 id="docs">Docs</h3>
<ul>
<li><a href="https://developer.apple.com/documentation/sign_in_with_apple/generate_and_validate_tokens" target="_blank" rel="nofollow">Apple Developer Documentation</a></li>
</ul>
<h2 id="steps">Steps</h2>
<h3 id="1-settings-on-the-apple-developer-page">1. Settings on the Apple Developer page</h3>
<p><strong>A paid apple developer membership account is required for this step!</strong></p>
<p>In this step, we need to setup two things:</p>
<ul>
<li>an identifier that configures the App capabilities.</li>
<li>create a private key.</li>
</ul>
<h4 id="editcreate-identifier">edit/create Identifier</h4>
<p>Visit <a href="https://developer.apple.com/account/resources/certificates/list" target="_blank" rel="nofollow">Certificates, Identifiers &#x26; Profiles</a>. Choose ‚Äú<a href="https://developer.apple.com/account/resources/identifiers/list" target="_blank" rel="nofollow">Identifiers</a>‚Äú and create/edit the APP‚Äôs identifier. Make sure ‚ÄúSign in with Apple‚Äú is selected in Capabilities.</p>
<p><img src="https://s2.loli.net/2023/03/02/KQPRUTC1rdqVnyu.jpg" alt="sign in with apple"></p>
<p>After the identifier is created, it will show <strong>team ID</strong> and <strong>bundle ID</strong>.</p>
<p>we can also find team ID on <a href="https://developer.apple.com/account" target="_blank" rel="nofollow">account page</a>.</p>
<h4 id="create-private-key">create private key</h4>
<p>Choose ‚Äú<a href="https://developer.apple.com/account/resources/authkeys/list" target="_blank" rel="nofollow">keys</a>‚Äú and register a new key, also make sure ‚ÄúSign in with Apple‚Äú is selected.</p>
<p><img src="https://s2.loli.net/2023/03/02/HdgeWFJ5iU18lPQ.jpg" alt=""></p>
<p>Then select the Primary app ID as the identifier bundle ID we just edited/selected.</p>
<p><img src="https://s2.loli.net/2023/03/02/14Mr82uSjNiplna.jpg" alt=""></p>
<p>After it‚Äôs registered, it will provide a <strong>one-time</strong> download link to download the <strong>private key</strong> file.</p>
<p>Also, it has a <strong>key ID</strong>.</p>
<p><img src="https://s2.loli.net/2023/03/02/J1hN4YLM38aIUog.jpg" alt=""></p>
<h3 id="2-settings-in-xcode">2. Settings in Xcode</h3>
<p>Open App project, Select ‚ÄúTarget-Runner-Signing &#x26; Capabilities‚Äú and add ‚ÄúSign in with Apple‚Äú Capability.</p>
<p><img src="https://s2.loli.net/2023/03/02/zn9LjGBDYqpmJSk.jpg" alt=""></p>
<p>Open ‚ÄúSigning‚Äú tab and select the developer team ID and bundle ID.</p>
<p><img src="https://s2.loli.net/2023/03/02/s4G7wMlEqYRf8Xk.jpg" alt=""></p>
<h3 id="3-logic-in-the-client-side">3. Logic in the Client side</h3>
<p>We are using flutter to build our App, and the package <a href="https://pub.dev/packages/sign_in_with_apple" target="_blank" rel="nofollow">sign_in_with_apple</a> will help integrate with Apple service to get the credential we need. It‚Äôs usage is very straightforward so just check the <a href="https://pub.dev/packages/sign_in_with_apple#example-usage" target="_blank" rel="nofollow">example</a>. And in the end, you will get a credential that contains the authorization code. It will be the key parameter for our App login API.</p>
<h3 id="4-logic-in-the-app-service-side">4. Logic in the App Service side</h3>
<p>The APP service will handle most part of the work. We are using node.js and the package <a href="https://www.npmjs.com/package/apple-signin-auth" target="_blank" rel="nofollow">apple-signin-auth</a>.</p>
<p>In this step, we only focus on two parts:</p>
<ul>
<li>create client secret</li>
<li>get authorization token</li>
</ul>
<h4 id="create-client-secret">create client secret</h4>
<p>Before we can ask Apple service for an authorization token, we need a ‚Äúclient secret‚Äú, which is a JWT used for each validation request between our server and apple service. if we check the <a href="https://developer.apple.com/documentation/sign_in_with_apple/generate_and_validate_tokens#3262048" target="_blank" rel="nofollow">doc</a> for details, we will see Apple requests the JWT be signed with a specific algorithm. So the <a href="https://www.npmjs.com/package/apple-signin-auth" target="_blank" rel="nofollow">apple-signin-auth</a> do us a favor, just use appleSignin.getClientSecret with the right parameters:</p>
<pre class="language-javascript"><code class="language-javascript"><span class="token keyword">const</span> clientSecret <span class="token operator">=</span> appleSignin<span class="token punctuation">.</span><span class="token method function property-access">getClientSecret</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">clientID</span><span class="token operator">:</span> <span class="token string">'com.company.app'</span><span class="token punctuation">,</span> <span class="token comment">// Apple Client ID, AKA Bundle ID</span>
  <span class="token literal-property property">teamID</span><span class="token operator">:</span> <span class="token string">'teamID'</span><span class="token punctuation">,</span> <span class="token comment">// Apple Developer Team ID.</span>
  <span class="token literal-property property">privateKey</span><span class="token operator">:</span> <span class="token string">'PRIVATE_KEY_STRING'</span><span class="token punctuation">,</span> <span class="token comment">// private key associated with your client ID. -- Or provide a `privateKeyPath` property instead.</span>
  <span class="token literal-property property">keyIdentifier</span><span class="token operator">:</span> <span class="token string">'XXXXXXXXXX'</span><span class="token punctuation">,</span> <span class="token comment">// identifier of the private key. AKA key ID. - can be found here https://developer.apple.com/account/resources/authkeys/list</span>
  <span class="token comment">// OPTIONAL</span>
  <span class="token literal-property property">expAfter</span><span class="token operator">:</span> <span class="token number">15777000</span><span class="token punctuation">,</span> <span class="token comment">// Duration after which to expire JWT</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<h3 id="get-authorization-token">get authorization token</h3>
<p>This part is straightforward. Just call the API and Apple service will return the authorization token. We can check the <a href="https://developer.apple.com/documentation/sign_in_with_apple/generate_and_validate_tokens#url" target="_blank" rel="nofollow">doc</a> and as always, <a href="https://www.npmjs.com/package/apple-signin-auth" target="_blank" rel="nofollow">apple-signin-auth</a> wrapped it as a function to call:</p>
<pre class="language-javascript"><code class="language-javascript"><span class="token keyword">const</span> options <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">clientID</span><span class="token operator">:</span> <span class="token string">'com.company.app'</span><span class="token punctuation">,</span> <span class="token comment">// Apple Client ID, AKA Bundle ID</span>
  <span class="token literal-property property">redirectUri</span><span class="token operator">:</span> <span class="token string">'http://localhost:3000/auth/apple/callback'</span><span class="token punctuation">,</span> <span class="token comment">// We don't need it in our login flow.</span>
  <span class="token literal-property property">clientSecret</span><span class="token operator">:</span> clientSecret
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword control-flow">try</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> tokenResponse <span class="token operator">=</span> <span class="token keyword control-flow">await</span> appleSignin<span class="token punctuation">.</span><span class="token method function property-access">getAuthorizationToken</span><span class="token punctuation">(</span>code<span class="token punctuation">,</span> options<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token keyword control-flow">catch</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">error</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<p>Once our App Service gets the authorization token, we can do our business logic, like getting the user info, which shouldn‚Äôt be a problem.</p>
<h2 id="conclusion">Conclusion</h2>
<p>So this is the way to support Apple login <strong>based on the authorization code in</strong> <strong>iOS</strong>. Just remember there are other ways and more to set up if you want to support Android or Web.</p>
</body></html></div></div></div></div></div><div class="sc-bbd5e802-0 cbkQsN"><div></div></div></div></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"id":"apple-login-with-flutter-in-ios","title":"Sign in with apple by Flutter in iOS","date":"2023-03-02","htmlText":"\u003chtml\u003e\u003chead\u003e\u003c/head\u003e\u003cbody\u003e\u003cp\u003eSign in with Apple is commonly used by modern apps now, this article will introduce a way to implement it with Flutter for iOS apps.\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"#intro\"\u003eIntro\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"#flow\"\u003eFlow\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#used-packages\"\u003eUsed Packages\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#docs\"\u003eDocs\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#steps\"\u003eSteps\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"#1-settings-on-the-apple-developer-page\"\u003e1. Settings on the Apple Developer page\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"#editcreate-identifier\"\u003eedit/create Identifier\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#create-private-key\"\u003ecreate private key\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#2-settings-in-xcode\"\u003e2. Settings in Xcode\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#3-logic-in-the-client-side\"\u003e3. Logic in the Client side\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#4-logic-in-the-app-service-side\"\u003e4. Logic in the App Service side\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"#create-client-secret\"\u003ecreate client secret\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#get-authorization-token\"\u003eget authorization token\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#conclusion\"\u003eConclusion\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2 id=\"intro\"\u003eIntro\u003c/h2\u003e\n\u003cp\u003eHere I will introduce the Apple login flow in iOS, which is \u003cstrong\u003ebased on the authorization code.\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003eThere should be another way to use the identity token and Apple public key to do the same job, but we didn‚Äôt put it into practice, so for now I won‚Äôt cover it.\u003c/p\u003e\n\u003ch3 id=\"flow\"\u003eFlow\u003c/h3\u003e\n\u003cp\u003eThe iOS apple login flow is not bounded with flutter tech (Apple login in Android or Web has more steps than this and is not introduced here).\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://s2.loli.net/2023/03/02/IhVbdx2l3JFeP56.png\" alt=\"apple login in iOS\"\u003e\u003c/p\u003e\n\u003ch3 id=\"used-packages\"\u003eUsed Packages\u003c/h3\u003e\n\u003cul\u003e\n\u003cli\u003eFlutter\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"https://pub.dev/packages/sign_in_with_apple\" target=\"_blank\" rel=\"nofollow\"\u003esign_in_with_apple\u003c/a\u003e. Flutter bridge to Sign in with Apple.\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003eNode\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"https://www.npmjs.com/package/apple-signin-auth\" target=\"_blank\" rel=\"nofollow\"\u003eapple-signin-auth\u003c/a\u003e. Apple sign in for Node.js.\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch3 id=\"docs\"\u003eDocs\u003c/h3\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"https://developer.apple.com/documentation/sign_in_with_apple/generate_and_validate_tokens\" target=\"_blank\" rel=\"nofollow\"\u003eApple Developer Documentation\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2 id=\"steps\"\u003eSteps\u003c/h2\u003e\n\u003ch3 id=\"1-settings-on-the-apple-developer-page\"\u003e1. Settings on the Apple Developer page\u003c/h3\u003e\n\u003cp\u003e\u003cstrong\u003eA paid apple developer membership account is required for this step!\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003eIn this step, we need to setup two things:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003ean identifier that configures the App capabilities.\u003c/li\u003e\n\u003cli\u003ecreate a private key.\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch4 id=\"editcreate-identifier\"\u003eedit/create Identifier\u003c/h4\u003e\n\u003cp\u003eVisit \u003ca href=\"https://developer.apple.com/account/resources/certificates/list\" target=\"_blank\" rel=\"nofollow\"\u003eCertificates, Identifiers \u0026#x26; Profiles\u003c/a\u003e. Choose ‚Äú\u003ca href=\"https://developer.apple.com/account/resources/identifiers/list\" target=\"_blank\" rel=\"nofollow\"\u003eIdentifiers\u003c/a\u003e‚Äú and create/edit the APP‚Äôs identifier. Make sure ‚ÄúSign in with Apple‚Äú is selected in Capabilities.\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://s2.loli.net/2023/03/02/KQPRUTC1rdqVnyu.jpg\" alt=\"sign in with apple\"\u003e\u003c/p\u003e\n\u003cp\u003eAfter the identifier is created, it will show \u003cstrong\u003eteam ID\u003c/strong\u003e and \u003cstrong\u003ebundle ID\u003c/strong\u003e.\u003c/p\u003e\n\u003cp\u003ewe can also find team ID on \u003ca href=\"https://developer.apple.com/account\" target=\"_blank\" rel=\"nofollow\"\u003eaccount page\u003c/a\u003e.\u003c/p\u003e\n\u003ch4 id=\"create-private-key\"\u003ecreate private key\u003c/h4\u003e\n\u003cp\u003eChoose ‚Äú\u003ca href=\"https://developer.apple.com/account/resources/authkeys/list\" target=\"_blank\" rel=\"nofollow\"\u003ekeys\u003c/a\u003e‚Äú and register a new key, also make sure ‚ÄúSign in with Apple‚Äú is selected.\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://s2.loli.net/2023/03/02/HdgeWFJ5iU18lPQ.jpg\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003eThen select the Primary app ID as the identifier bundle ID we just edited/selected.\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://s2.loli.net/2023/03/02/14Mr82uSjNiplna.jpg\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003eAfter it‚Äôs registered, it will provide a \u003cstrong\u003eone-time\u003c/strong\u003e download link to download the \u003cstrong\u003eprivate key\u003c/strong\u003e file.\u003c/p\u003e\n\u003cp\u003eAlso, it has a \u003cstrong\u003ekey ID\u003c/strong\u003e.\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://s2.loli.net/2023/03/02/J1hN4YLM38aIUog.jpg\" alt=\"\"\u003e\u003c/p\u003e\n\u003ch3 id=\"2-settings-in-xcode\"\u003e2. Settings in Xcode\u003c/h3\u003e\n\u003cp\u003eOpen App project, Select ‚ÄúTarget-Runner-Signing \u0026#x26; Capabilities‚Äú and add ‚ÄúSign in with Apple‚Äú Capability.\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://s2.loli.net/2023/03/02/zn9LjGBDYqpmJSk.jpg\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003eOpen ‚ÄúSigning‚Äú tab and select the developer team ID and bundle ID.\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://s2.loli.net/2023/03/02/s4G7wMlEqYRf8Xk.jpg\" alt=\"\"\u003e\u003c/p\u003e\n\u003ch3 id=\"3-logic-in-the-client-side\"\u003e3. Logic in the Client side\u003c/h3\u003e\n\u003cp\u003eWe are using flutter to build our App, and the package \u003ca href=\"https://pub.dev/packages/sign_in_with_apple\" target=\"_blank\" rel=\"nofollow\"\u003esign_in_with_apple\u003c/a\u003e will help integrate with Apple service to get the credential we need. It‚Äôs usage is very straightforward so just check the \u003ca href=\"https://pub.dev/packages/sign_in_with_apple#example-usage\" target=\"_blank\" rel=\"nofollow\"\u003eexample\u003c/a\u003e. And in the end, you will get a credential that contains the authorization code. It will be the key parameter for our App login API.\u003c/p\u003e\n\u003ch3 id=\"4-logic-in-the-app-service-side\"\u003e4. Logic in the App Service side\u003c/h3\u003e\n\u003cp\u003eThe APP service will handle most part of the work. We are using node.js and the package \u003ca href=\"https://www.npmjs.com/package/apple-signin-auth\" target=\"_blank\" rel=\"nofollow\"\u003eapple-signin-auth\u003c/a\u003e.\u003c/p\u003e\n\u003cp\u003eIn this step, we only focus on two parts:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003ecreate client secret\u003c/li\u003e\n\u003cli\u003eget authorization token\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch4 id=\"create-client-secret\"\u003ecreate client secret\u003c/h4\u003e\n\u003cp\u003eBefore we can ask Apple service for an authorization token, we need a ‚Äúclient secret‚Äú, which is a JWT used for each validation request between our server and apple service. if we check the \u003ca href=\"https://developer.apple.com/documentation/sign_in_with_apple/generate_and_validate_tokens#3262048\" target=\"_blank\" rel=\"nofollow\"\u003edoc\u003c/a\u003e for details, we will see Apple requests the JWT be signed with a specific algorithm. So the \u003ca href=\"https://www.npmjs.com/package/apple-signin-auth\" target=\"_blank\" rel=\"nofollow\"\u003eapple-signin-auth\u003c/a\u003e do us a favor, just use appleSignin.getClientSecret with the right parameters:\u003c/p\u003e\n\u003cpre class=\"language-javascript\"\u003e\u003ccode class=\"language-javascript\"\u003e\u003cspan class=\"token keyword\"\u003econst\u003c/span\u003e clientSecret \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e appleSignin\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token method function property-access\"\u003egetClientSecret\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"token literal-property property\"\u003eclientID\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token string\"\u003e'com.company.app'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token comment\"\u003e// Apple Client ID, AKA Bundle ID\u003c/span\u003e\n  \u003cspan class=\"token literal-property property\"\u003eteamID\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token string\"\u003e'teamID'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token comment\"\u003e// Apple Developer Team ID.\u003c/span\u003e\n  \u003cspan class=\"token literal-property property\"\u003eprivateKey\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token string\"\u003e'PRIVATE_KEY_STRING'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token comment\"\u003e// private key associated with your client ID. -- Or provide a `privateKeyPath` property instead.\u003c/span\u003e\n  \u003cspan class=\"token literal-property property\"\u003ekeyIdentifier\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token string\"\u003e'XXXXXXXXXX'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token comment\"\u003e// identifier of the private key. AKA key ID. - can be found here https://developer.apple.com/account/resources/authkeys/list\u003c/span\u003e\n  \u003cspan class=\"token comment\"\u003e// OPTIONAL\u003c/span\u003e\n  \u003cspan class=\"token literal-property property\"\u003eexpAfter\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token number\"\u003e15777000\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token comment\"\u003e// Duration after which to expire JWT\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch3 id=\"get-authorization-token\"\u003eget authorization token\u003c/h3\u003e\n\u003cp\u003eThis part is straightforward. Just call the API and Apple service will return the authorization token. We can check the \u003ca href=\"https://developer.apple.com/documentation/sign_in_with_apple/generate_and_validate_tokens#url\" target=\"_blank\" rel=\"nofollow\"\u003edoc\u003c/a\u003e and as always, \u003ca href=\"https://www.npmjs.com/package/apple-signin-auth\" target=\"_blank\" rel=\"nofollow\"\u003eapple-signin-auth\u003c/a\u003e wrapped it as a function to call:\u003c/p\u003e\n\u003cpre class=\"language-javascript\"\u003e\u003ccode class=\"language-javascript\"\u003e\u003cspan class=\"token keyword\"\u003econst\u003c/span\u003e options \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"token literal-property property\"\u003eclientID\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token string\"\u003e'com.company.app'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token comment\"\u003e// Apple Client ID, AKA Bundle ID\u003c/span\u003e\n  \u003cspan class=\"token literal-property property\"\u003eredirectUri\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token string\"\u003e'http://localhost:3000/auth/apple/callback'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token comment\"\u003e// We don't need it in our login flow.\u003c/span\u003e\n  \u003cspan class=\"token literal-property property\"\u003eclientSecret\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e clientSecret\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"token keyword control-flow\"\u003etry\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"token keyword\"\u003econst\u003c/span\u003e tokenResponse \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token keyword control-flow\"\u003eawait\u003c/span\u003e appleSignin\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token method function property-access\"\u003egetAuthorizationToken\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003ecode\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e options\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e \u003cspan class=\"token keyword control-flow\"\u003ecatch\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eerr\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"token console class-name\"\u003econsole\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token method function property-access\"\u003eerror\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eerr\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eOnce our App Service gets the authorization token, we can do our business logic, like getting the user info, which shouldn‚Äôt be a problem.\u003c/p\u003e\n\u003ch2 id=\"conclusion\"\u003eConclusion\u003c/h2\u003e\n\u003cp\u003eSo this is the way to support Apple login \u003cstrong\u003ebased on the authorization code in\u003c/strong\u003e \u003cstrong\u003eiOS\u003c/strong\u003e. Just remember there are other ways and more to set up if you want to support Android or Web.\u003c/p\u003e\n\u003c/body\u003e\u003c/html\u003e","description":"Sign in with Apple is commonly used by modern apps now, this article will introduce a way to impleme......"},"__N_SSG":true},"page":"/posts/[id]","query":{"id":"apple-login-with-flutter-in-ios"},"buildId":"u9-Sh7cpFEfudU57A_VSr","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>