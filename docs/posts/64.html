<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width"/><html lang="zh-Hans"></html><title>LWDW!</title><meta name="theme-color" content="#000"/><meta name="next-head-count" content="5"/><link rel="preload" href="/_next/static/css/aef510c8abf24c2c.css" as="style"/><link rel="stylesheet" href="/_next/static/css/aef510c8abf24c2c.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-c67a75d1b6f99dc8.js"></script><script src="/_next/static/chunks/webpack-f164db4954bac6ec.js" defer=""></script><script src="/_next/static/chunks/framework-114634acb84f8baa.js" defer=""></script><script src="/_next/static/chunks/main-673a4fae4a27af6a.js" defer=""></script><script src="/_next/static/chunks/pages/_app-cbff4cff013213c5.js" defer=""></script><script src="/_next/static/chunks/664-1b4479b4462ded63.js" defer=""></script><script src="/_next/static/chunks/332-870bd19cd67b43d2.js" defer=""></script><script src="/_next/static/chunks/740-8163689fd2f6810b.js" defer=""></script><script src="/_next/static/chunks/pages/posts/%5Bid%5D-fe071bc13d7b165a.js" defer=""></script><script src="/_next/static/tKfBGEZFvCFnggBSjysjf/_buildManifest.js" defer=""></script><script src="/_next/static/tKfBGEZFvCFnggBSjysjf/_ssgManifest.js" defer=""></script></head><body><div id="__next"><div class="sc-a1085f02-0 eHZcHI"><div class="sc-7fa12c98-0 iqAzDm"><div class="sc-78f004b3-1 hMmnK"><div class="sc-78f004b3-0 MUgkG"><a class="sc-78f004b3-2 kiBeJX" href="/">[<!-- -->Home<!-- -->]</a><a class="sc-78f004b3-2 kiBeJX" href="/posts">[<!-- -->Posts<!-- -->]</a></div><div class="sc-f5ce872-0 drvesR"><h1 class="sc-f5ce872-1 jPBPjm">LWDW!</h1><p class="sc-f5ce872-2 djaGsH">Learn the work from doing the work🍺</p></div></div><div class="sc-c80897d2-0 sc-20291786-0 xdBKv eCERES"><div><div class="sc-1175c39b-0 gMgZqX"><div class="sc-1175c39b-2 hUDVRc">《试图了解XSS注入，却发现了奇妙的基础问题！》</div><div class="sc-1175c39b-3 hftWtW">Posted on <!-- -->2017-09-26</div></div></div></div><div class="sc-c80897d2-0 xdBKv"><div><div class="sc-1175c39b-1 kJGBQN"><div class="sc-d48aeb73-0 icKMYn"></div></div></div></div></div></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"id":"64","title":"《试图了解XSS注入，却发现了奇妙的基础问题！》","date":"2017-09-26","mdText":"\n啧，现在的轻小说起名真是浮夸【瞄】\n\nweb安全，xss注入，blablabla......相关的博文看了不少，感觉相当单纯，不就是`\u003cscript\u003e`嘛！转义嘛！结果自己尝试时又是喜闻乐见地发现，注入还没看多少，基础问题暴露一堆。\n\n## 注入入口 and 渲染方式\n\nxss注入实现的攻击，总的来说是：\n\n1. 通过某种方式将需要执行的代码注入到服务器所存储的数据中\n2. 其他客户端从服务器拿到数据渲染时，执行了注入其中的代码\n\n从某种意义上讲，这两步需要成功匹配，才能实现注入\n\n### 耿直注入\n\n最容易想到的注入入口就是`input`输入框，在这里就涉及到一个小知识点：**input输入框中的内容(value属性值)是转义后的值**。记好这一点嗯嗯。\n\n确定从 input 进行注入后，需要考虑的就是客户端的渲染方式了——咱尝试了以下几种方式：\n\n1. 首先很想当然的，想通过设置 dom元素的**`innerHTML`**属性进行渲染，然而…不行！**innerHTML的确会非常耿直的把标签啥的直接当作节点插入，但是插入后不会执行`\u003cscript\u003e内的内容`**，所以咱的脚本成功进入了客户端，却未被执行，可惜可惜。\n2. 通过**`appendChild()`**方法，是可以的！\n3. Jquery的**`append()`**方法也是通过`innerHTML`渲染，但它会试图找到`script`标签，将其通过`eval()`执行，所以当然是可以的。要是用这种方法渲染用户可以决定的字段，简直是二五仔啊！\n\n### 防范？\n\n所以就像所有博文都会告诉你的防范方法：**转义 `\u003c`和`\u003e`**，将其变为**html字符实体**，于是可喜可贺可喜可贺，这种方法可以毁灭性的摧毁用`\u003cscript\u003e`字符串进行注入的想法，以上三种渲染方式都不会中招。\n\n当然，道高一尺魔高一丈嘛，接下来博文就会告诉你，你可以用 **unicode码** 来表示  **\u003c** 和 **\u003e**，于是咱就迫不及待的在输入框中输入了伪装后的代码，然而它们却...直接被渲染出来了…没错，上面提到了，**input输入框中的内容(value属性值)是转义后的值**，你以为我是unicode码，其实我被已经转义啦（dio脸）！所以如果你想通过unicode码伪装，恐怕需要自己手动为请求数据赋值，比如从控制台手动请求接口。\n\n### 套路注入\n\n假设我们已经成功用unicode码发出了请求，结果是......并没有卵用？嗯？这和博文上说的不一样啊。根据粗浅的研究，似乎是因为咱是node服务器啊，unicode码在node环境下已经被表示为符号形式了？然后直接被上文的防范措施干掉了。不过似乎对于php服务器，unicode码是可以保持它原本的样子，成功绕过上文的防范成功注入。\n\n### 套路防范\n\n那么我们的解决方法是…没错，继续转义，这次要干掉的是 **`\\`**,而在这里又意识到个很好笑的问题，因为咱不懂PHP，就试图在js中还原该场景。js中如何匹配字符串中的 `\\` ？正则应该是 `/\\\\/g`，因为 `\\`是本身就是用于转义特殊符号的嘛，那我们可以转义的字符串呢？是这样的`\"i want to replace \\\\\"`，这时才意识到这是个大乌龙啊！前面就说过了unicode码，如`\"\\u003c\"`(`\u003c`)，一旦在node环境中作为字符串出现，会被直接解释为`\"\u003c\"`，根本轮不到咱插手啊【扑通】。总之，经过一通令人窒息的操作之后，才真切意识到：**我们输入的字符，代码执行时所“看到”字符（手动比喻），和输出的字符**，很多时候是不一样的。\n\n------\n\n咱大胆的假设！如果假设真的有除了咱以外的人看这篇水文，会不会有种偏题的感觉？xss都没讲完啊喂，什么img标签onerror注入url注入都没讲诶！emmmmme可是咱在学习时的确会遇到这种“偏题”的情况，咱正是试图用水文的形式记录下这诡异的思路，而不是总结一遍早有无数博文总结的要点【蛤你就是懒】，就是这样！溜了溜了【逃】\n\n"},"__N_SSG":true},"page":"/posts/[id]","query":{"id":"64"},"buildId":"tKfBGEZFvCFnggBSjysjf","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>